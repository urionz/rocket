function module(e,t,a){let n,i,s,o,l,c;a.link("meteor/meteor",{Meteor(e){n=e}},0),a.link("meteor/reactive-var",{ReactiveVar(e){i=e}},1),a.link("meteor/templating",{Template(e){s=e}},2),a.link("../../../../../ui-utils",{modal(e){o=e}},3),a.link("../../../../../utils",{t(e){l=e},handleError(e){c=e}},4),a.link("./livechatIntegrationFacebook.html"),s.livechatIntegrationFacebook.helpers({pages:()=>s.instance().pages.get(),subscribed(){return this.subscribed?"checked":""},enabled:()=>s.instance().enabled.get(),hasToken:()=>s.instance().hasToken.get(),enableButtonDisabled:()=>s.instance().hasToken.get()?"":"disabled",isLoading:()=>s.instance().loading.get()}),s.livechatIntegrationFacebook.onCreated((function(){var e=this;this.enabled=new i(!1),this.hasToken=new i(!1),this.pages=new i([]),this.loading=new i(!1),this.autorun(()=>{this.enabled.get()&&this.loadPages()}),this.result=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};return(i,s)=>{if(i&&i.error)switch(i.error){case"invalid-facebook-token":case"invalid-instance-url":case"integration-disabled":return n.call("livechat:facebook",{action:"enable"},e.result(()=>{e.enabled.set(!0),e.loadPages()},()=>e.loadPages()))}if(!s||!1!==s.success||"OAuthException"!==s.type&&void 0===s.url){if(i)return a(i),o.open({title:l("Error_loading_pages"),text:i.reason,type:"error"});t(s)}else{const e=window.open(s.url,"facebook-integration-oauth","width=600,height=400"),t=setInterval(()=>{e.closed&&(clearInterval(t),a(i))},300)}}},this.loadPages=()=>{this.pages.set([]),this.loading.set(!0),n.call("livechat:facebook",{action:"list-pages"},this.result(e=>{this.pages.set(e.pages),this.loading.set(!1)},()=>this.loading.set(!1)))}})),s.livechatIntegrationFacebook.onRendered((function(){this.loading.set(!0),n.call("livechat:facebook",{action:"initialState"},this.result(e=>{this.enabled.set(e.enabled),this.hasToken.set(e.hasToken),this.loading.set(!1)}))})),s.livechatIntegrationFacebook.events({"click .reload"(e,t){e.preventDefault(),t.loadPages()},"click .enable"(e,t){e.preventDefault(),n.call("livechat:facebook",{action:"enable"},t.result(()=>{t.enabled.set(!0)},()=>t.enabled.set(!0)))},"click .disable"(e,t){e.preventDefault(),o.open({title:l("Disable_Facebook_integration"),text:l("Are_you_sure_you_want_to_disable_Facebook_integration"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:l("Yes"),cancelButtonText:l("Cancel"),closeOnConfirm:!1,html:!1},()=>{n.call("livechat:facebook",{action:"disable"},e=>{if(e)return c(e);t.enabled.set(!1),t.pages.set([]),o.open({title:l("Disabled"),text:l("Integration_disabled"),type:"success",timer:2e3,showConfirmButton:!1})})})},"change [name=subscribe]"(e,t){n.call("livechat:facebook",{action:e.currentTarget.checked?"subscribe":"unsubscribe",page:this.id},(a,n)=>{if(n.success){const a=t.pages.get();a.forEach(t=>{t.id===this.id&&(t.subscribed=e.currentTarget.checked)}),t.pages.set(a)}})}})}

