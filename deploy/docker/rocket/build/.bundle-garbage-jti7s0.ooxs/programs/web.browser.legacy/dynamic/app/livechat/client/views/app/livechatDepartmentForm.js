function module(e,t,n){var r,a,i,s,o,c,u,l,m,f,g,d,p,h;n.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),n.link("meteor/meteor",{Meteor:function(e){a=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){i=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){s=e}},2),n.link("meteor/templating",{Template:function(e){o=e}},3),n.link("underscore",{default:function(e){c=e}},4),n.link("toastr",{default:function(e){u=e}},5),n.link("../../../../ui-utils",{TabBar:function(e){l=e},RocketChatTabBar:function(e){m=e}},6),n.link("../../../../utils",{t:function(e){f=e},handleError:function(e){g=e}},7),n.link("../../../../authorization",{hasPermission:function(e){d=e}},8),n.link("./customTemplates/register",{getCustomFormTemplate:function(e){p=e}},9),n.link("./livechatDepartmentForm.html"),n.link("../../../../utils/client",{APIClient:function(e){h=e}},10),o.livechatDepartmentForm.helpers({department:function(){return o.instance().department.get()},agents:function(){return o.instance().department&&!c.isEmpty(o.instance().department.get())?o.instance().department.get().agents:[]},departmentAgents:function(){return c.sortBy(o.instance().departmentAgents.get(),"username")},showOnRegistration:function(e){var t=o.instance().department.get();return t.showOnRegistration===e||void 0===t.showOnRegistration&&!0===e},showOnOfflineForm:function(e){var t=o.instance().department.get();return t.showOnOfflineForm===e||void 0===t.showOnOfflineForm&&!0===e},requestTagBeforeClosingChat:function(){var e=o.instance().department.get();return!(!e||!e.requestTagBeforeClosingChat)},customFieldsTemplate:function(){return p("livechatDepartmentForm")},data:function(){return{id:s.getParam("_id")}},exceptionsAgents:function(){return c.pluck(o.instance().departmentAgents.get(),"username")},agentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return"@"+(0===n.length?t:t.replace(new RegExp(e.get()),(function(e){return"<strong>"+e+"</strong>"})))}},agentConditions:function(){return{roles:"livechat-agent"}},onSelectAgents:function(){return o.instance().onSelectAgents},selectedAgents:function(){return o.instance().selectedAgents.get()},onClickTagAgents:function(){return o.instance().onClickTagAgents},flexData:function(){return{tabBar:o.instance().tabBar,data:o.instance().tabBarData.get()}},tabBarVisible:function(){return Object.values(l.buttons.get()).some((function(e){return e.groups.some((function(e){return e.startsWith("livechat-department")}))}))}}),o.livechatDepartmentForm.events({"submit #department-form":function(e,t){e.preventDefault();var n=t.$("button.save"),r,i=$(e.currentTarget).data("id");if(d("manage-livechat-departments")){var o=t.$("input[name=enabled]:checked").val(),c=t.$("input[name=name]").val(),l=t.$("textarea[name=description]").val(),m=t.$("input[name=showOnRegistration]:checked").val(),p=t.$("input[name=email]").val(),h=t.$("input[name=showOnOfflineForm]:checked").val(),v=t.$("input[name=requestTagBeforeClosingChat]:checked").val();if("1"!==o&&"0"!==o)return u.error(f("Please_select_enabled_yes_or_no"));if(""===c.trim())return u.error(f("Please_fill_a_name"));if(""===p.trim()&&"1"===h)return u.error(f("Please_fill_an_email"));r={enabled:"1"===o,name:c.trim(),description:l.trim(),showOnRegistration:"1"===m,showOnOfflineForm:"1"===h,requestTagBeforeClosingChat:"1"===v,email:p.trim()}}var k=n.html();n.html(f("Saving")),t.$(".customFormField").each((function(e,n){var a=t.$(n),i=a.attr("name");r[i]=a.val()}));var A=[];t.departmentAgents.get().forEach((function(e){e.count=t.$(".count-"+e.agentId).val(),e.order=t.$(".order-"+e.agentId).val(),A.push(e)}));var w=function(e){if(n.html(k),e)return g(e);u.success(f("Saved")),s.go("livechat-departments")};if(d("manage-livechat-departments"))a.call("livechat:saveDepartment",i,r,A,w);else{if(!d("add-livechat-department-agents"))throw new Error(f("error-not-authorized"));a.call("livechat:saveDepartmentAgents",i,A,w)}},"click .add-agent":function(e,t){var n;e.preventDefault(),t.selectedAgents.get().forEach(function(){function e(e){var n,a,i,s;return r.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:if(n=e._id,a=e.username,!(i=t.departmentAgents.get()).find((function(e){var t;return e.agentId===n}))){r.next=4;break}return r.abrupt("return",u.error(f("This_agent_was_already_selected")));case 4:(s=c.clone(e)).agentId=n,delete s._id,i.push(s),t.departmentAgents.set(i),t.selectedAgents.set(t.selectedAgents.get().filter((function(e){return e.username!==a})));case 10:case"end":return r.stop()}}return r}())}return e}())},"click button.back":function(e){e.preventDefault(),s.go("livechat-departments")},"click .remove-agent":function(e,t){var n=this;e.preventDefault(),t.departmentAgents.set(t.departmentAgents.get().filter((function(e){return e.agentId!==n.agentId})))}}),o.livechatDepartmentForm.onCreated(function(){function e(){var e=this;return r.async(function(){function t(t){for(;;)switch(t.prev=t.next){case 0:this.department=new i({enabled:!0}),this.departmentAgents=new i([]),this.selectedAgents=new i([]),this.tabBar=new m,this.tabBar.showGroup(s.current().route.name),this.tabBarData=new i,this.onSelectAgents=function(t){var n=t.item;e.selectedAgents.set([n])},this.onClickTagAgent=function(t){var n=t.username;e.selectedAgents.set(e.selectedAgents.get().filter((function(e){return e.username!==n})))},this.autorun(function(){function t(){var t,n,a,i;return r.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:if(!(t=s.getParam("_id"))){o.next=9;break}return o.next=4,r.awrap(h.v1.get("livechat/department/"+s.getParam("_id")));case 4:n=o.sent,a=n.department,i=n.agents,e.department.set(a),e.departmentAgents.set(i);case 9:case"end":return o.stop()}}return o}())}return t}());case 9:case"end":return t.stop()}}return t}(),null,this)}return e}())}

