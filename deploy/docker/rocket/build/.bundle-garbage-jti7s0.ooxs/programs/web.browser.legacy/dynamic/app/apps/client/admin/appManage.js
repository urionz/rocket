function module(e,t,n){var r,a,s,i,u,c,o,p,l,g,f,h,d,v,k,m,b,x,P,A,w,_,y,S,L,C;n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),n.link("@babel/runtime/helpers/toConsumableArray",{default:function(e){a=e}},1),n.link("@babel/runtime/helpers/objectSpread2",{default:function(e){s=e}},2),n.link("@babel/runtime/regenerator",{default:function(e){i=e}},3),n.link("meteor/meteor",{Meteor:function(e){u=e}},0),n.link("meteor/reactive-dict",{ReactiveDict:function(e){c=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){o=e}},2),n.link("meteor/templating",{Template:function(e){p=e}},3),n.link("meteor/rocketchat:tap-i18n",{TAPi18n:function(e){l=e},TAPi18next:function(e){g=e}},4),n.link("meteor/tracker",{Tracker:function(e){f=e}},5),n.link("underscore",{default:function(e){h=e}},6),n.link("../../../ui-utils/client",{SideNav:function(e){d=e}},7),n.link("../../../utils",{isEmail:function(e){v=e}},8),n.link("../../lib/misc/Utilities",{Utilities:function(e){k=e}},9),n.link("../communication",{AppEvents:function(e){m=e}},10),n.link("../orchestrator",{Apps:function(e){b=e}},11),n.link("./helpers",{appButtonProps:function(e){x=e},appStatusSpanProps:function(e){P=e},formatPrice:function(e){A=e},formatPricingPlan:function(e){w=e},handleAPIError:function(e){_=e},triggerAppPopoverMenu:function(e){y=e},promptSubscription:function(e){S=e},warnStatusChange:function(e){L=e},checkCloudLogin:function(e){C=e}},12),n.link("./appManage.html"),n.link("./appManage.css");var I=function(){function e(e,t){var n;return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,i.awrap(b.getAppApis(e));case 3:n=r.sent,t.set("apis",n),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),_(r.t0);case 10:case"end":return r.stop()}}return r}(),null,null,[[0,7]])}return e}(),T=function(){function e(e,t){var n,r,a,s;return i.async(function(){function u(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,u.next=3,i.awrap(b.getAppSettings(e));case 3:for(n=u.sent,r=0,a=Object.values(n);r<a.length;r++)(s=a[r]).i18nPlaceholder=s.i18nPlaceholder||" ",s.value=void 0!==s.value&&null!==s.value?s.value:s.packageValue,s.oldValue=s.value,s.hasChanged=!1;t.set("settings",n),u.next=11;break;case 8:u.prev=8,u.t0=u.catch(0),_(u.t0);case 11:case"end":return u.stop()}}return u}(),null,null,[[0,8]])}return e}(),D=function(e,t){e&&e.length&&e.forEach(function(){function n(n,r){var a;return i.async(function(){function s(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,i.awrap(b.getAppsOnBundle(n.bundleId));case 3:a=s.sent,n.apps=a.slice(0,4),s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),_(s.t0);case 10:e[r]=n,t.set("bundledIn",e);case 12:case"end":return s.stop()}}return s}(),null,null,[[0,7]])}return n}())},E=function(){function e(e,t,n){var r,a,s,u,c,o,p,l;return i.async(function(){function g(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,i.awrap(b.getLatestAppFromMarketplace(e,t));case 3:r=g.sent,a=r.categories,s=r.isPurchased,u=r.price,c=r.bundledIn,o=r.purchaseType,p=r.subscriptionInfo,l=r.version,n.set({categories:a,isPurchased:s,price:u,bundledIn:c,purchaseType:o,subscriptionInfo:p,marketplaceVersion:l}),D(c,n),g.next=20;break;case 15:if(g.prev=15,g.t0=g.catch(0),!g.t0.xhr||404!==g.t0.xhr.status){g.next=19;break}return g.abrupt("return");case 19:_(g.t0);case 20:case"end":return g.stop()}}return g}(),null,null,[[0,15]])}return e}(),j=function(){function e(e){var t,n,r,a,u;return i.async(function(){function c(c){for(;;)switch(c.prev=c.next){case 0:return t=e.appId,n=e.version,r=e.state,a=e._app,c.prev=1,c.next=4,i.awrap(b.getApp(t));case 4:u=c.sent,c.next=10;break;case 7:c.prev=7,c.t0=c.catch(1),console.error(c.t0);case 10:if(r.set("settings",{}),!u){c.next=22;break}if(r.set("isLoading",!1),a.clear(),a.set(s({},u,{installed:!0})),I(t,r),T(t,r),E(t,n,a),"marketplace-app"!==o.current().route.getRouteName()){c.next=21;break}return o.withReplaceState((function(){o.go("app-manage",{appId:t})})),c.abrupt("return");case 21:return c.abrupt("return");case 22:return c.prev=22,c.next=25,i.awrap(b.getAppFromMarketplace(t,n));case 25:u=c.sent,c.next=31;break;case 28:c.prev=28,c.t1=c.catch(22),r.set("error",c.t1);case 31:u&&(delete u.status,u.marketplaceVersion=u.version,r.set("isLoading",!1),a.clear(),a.set(s({},u,{installed:!1})),D(u.bundledIn,a),"app-manage"===o.current().route.getRouteName()&&o.withReplaceState((function(){o.go("marketplace-app",{appId:t})})));case 32:case"end":return c.stop()}}return c}(),null,null,[[1,7],[22,28]])}return e}();p.appManage.onCreated((function(){var e=this;this.appId=o.getParam("appId"),this.version=o.getQueryParam("version"),this.state=new c({settings:{},isLoading:!0,isSaving:!1}),this._app=new c({id:this.appId,version:this.version}),j(this),this.__=function(t,n,r){var a=k.getI18nKeyForApp(t,e.appId);return g.exists("project:"+a)?l.__(a,n,r):l.__(t,n,r)};var t=function(t){return function(n){var r=n.appId||n;if(r===e.appId){for(var a=arguments.length,s=new Array(a>1?a-1:0),i=1;i<a;i++)s[i-1]=arguments[i];t.call.apply(t,[e,n].concat(s))}}};this.handleSettingUpdated=t((function(){T(e.appId,e.state)})),this.handleChange=t((function(){j(e)})),this.handleRemoved=t((function(){return o.go("/admin/apps")})),b.getWsListener().registerListener(m.APP_ADDED,this.handleChange),b.getWsListener().registerListener(m.APP_UPDATED,this.handleChange),b.getWsListener().registerListener(m.APP_REMOVED,this.handleRemoved),b.getWsListener().registerListener(m.APP_STATUS_CHANGE,this.handleChange),b.getWsListener().registerListener(m.APP_SETTING_UPDATED,this.handleSettingUpdated)})),p.apps.onDestroyed((function(){b.getWsListener().unregisterListener(m.APP_ADDED,this.handleChange),b.getWsListener().unregisterListener(m.APP_UPDATED,this.handleChange),b.getWsListener().unregisterListener(m.APP_REMOVED,this.handleRemoved),b.getWsListener().unregisterListener(m.APP_STATUS_CHANGE,this.handleChange),b.getWsListener().unregisterListener(m.APP_SETTING_UPDATED,this.handleSettingUpdated)})),p.appManage.onRendered((function(){f.afterFlush((function(){d.setFlex("adminFlex"),d.openFlex()}))})),p.appManage.helpers({isSettingsPristine:function(){var e=p.instance().state.get("settings");return!Object.values(e).some((function(e){var t;return e.hasChanged}))},isSaving:function(){return p.instance().state.get("isSaving")},error:function(){var e=p.instance().state.get("error");return e&&(e.xhr&&e.xhr.responseJSON&&e.xhr.responseJSON.error||e.message)},isLoading:function(){return p.instance().state.get("isLoading")},appButtonProps:x,appStatusSpanProps:P,priceDisplay:function(){var e=[p.instance()._app.get("purchaseType"),p.instance()._app.get("price"),p.instance()._app.get("pricingPlans")],t,n=e[1],r=e[2];if("subscription"===e[0]){if(!r||!Array.isArray(r)||0===r.length)return;return w(r[0])}return n>0?A(n):"Free"},isEmail:v,_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=[n.slice(-2),n.slice(-1)[0]],i=a[0],u=a[1];return p.instance().__(e,s({},u.hash,{sprintf:i}))},languages:function(){return[{key:"",name:"Default",en:"Default"}].concat(a(Object.entries(l.getLanguages()).map((function(e){var t=r(e,2),n=t[0],a=t[1];return s({key:n},a)})).sort((function(e,t){var n=e.key,r=t.key;return n.localeCompare(r)}))))},selectedOption:function(e,t){var n;return p.instance().state.get("settings")[e].value===t},app:function(){return p.instance()._app.all()},errors:function(){var e,t=(p.instance()._app.get("licenseValidation")||{}).errors,n=void 0===t?{}:t;return Object.values(n)},warnings:function(){var e,t=(p.instance()._app.get("licenseValidation")||{}).warnings,n=void 0===t?{}:t;return Object.values(n)},settings:function(){return Object.values(p.instance().state.get("settings"))},apis:function(){return p.instance().state.get("apis")},curl:function(e,t){var n=t.examples[e]||{};return k.curl({url:u.absoluteUrl.defaultOptions.rootUrl+t.computedPath,method:e,params:n.params,query:n.query,content:n.content,headers:n.headers}).split("\n")},renderMethods:function(e){return e.join("|").toUpperCase()},bundleAppNames:function(e){return e.map((function(e){return e.latest.name})).join(", ")}}),p.appManage.events({"click .js-cancel-editing-settings":function(e,t){for(var n=t.state.get("settings"),r=0,a=Object.values(n);r<a.length;r++){var s=a[r];s.value=s.oldValue,s.hasChanged=!1}t.state.set("settings",n)},"click .js-save-settings":function(){function e(e,t){var n,r,a,s,u;return i.async(function(){function c(c){for(;;)switch(c.prev=c.next){case 0:if(e.preventDefault(),e.stopPropagation(),n=t.appId,!(r=t.state).get("isSaving")){c.next=5;break}return c.abrupt("return");case 5:if(r.set("isSaving",!0),a=r.get("settings"),c.prev=7,(s=Object.values(a).filter((function(e){var t;return e.hasChanged}))).length){c.next=11;break}return c.abrupt("return");case 11:return c.next=13,i.awrap(b.setAppSettings(n,s));case 13:(u=c.sent).forEach((function(e){var t=e.id,n=e.value;a[t].value=n,a[t].oldValue=n,a[t].hasChanged=!1})),r.set("settings",a),c.next=21;break;case 18:c.prev=18,c.t0=c.catch(7),_(c.t0);case 21:return c.prev=21,r.set("isSaving",!1),c.finish(21);case 24:case"end":return c.stop()}}return c}(),null,null,[[7,18,21,24]])}return e}(),"click .js-close":function(){"marketplace-app"!==o.current().route.getRouteName()?"app-manage"!==o.current().route.getRouteName()?window.history.back():o.go("apps"):o.go("marketplace")},"click .js-menu":function(e,t){e.stopPropagation();var n=e.currentTarget;y(t._app.all(),n,t)},"click .js-install, click .js-update":function(){function e(e,t){var n,r,a,s;return i.async(function(){function u(u){for(;;)switch(u.prev=u.next){case 0:return e.stopPropagation(),u.next=3,i.awrap(C());case 3:if(u.sent){u.next=5;break}return u.abrupt("return");case 5:return n=t.appId,(r=t._app).set("working",!0),u.prev=7,u.next=10,i.awrap(b.updateApp(n,r.get("marketplaceVersion")));case 10:a=u.sent,s=a.status,L(r.get("name"),s),u.next=18;break;case 15:u.prev=15,u.t0=u.catch(7),_(u.t0);case 18:return u.prev=18,r.set("working",!1),u.finish(18);case 21:case"end":return u.stop()}}return u}(),null,null,[[7,15,18,21]])}return e}(),"click .js-purchase":function(){function e(e,t){var n,r;return i.async(function(){function e(e){for(;;)switch(e.prev=e.next){case 0:return n=t._app,e.next=3,i.awrap(C());case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:return n.set("working",!0),r=n.all(),e.next=9,i.awrap(S(r,function(){function e(){var e,t;return i.async(function(){function a(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,i.awrap(b.installApp(r.id,r.marketplaceVersion));case 3:e=a.sent,t=e.status,L(r.name,t),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),_(a.t0);case 11:return a.prev=11,n.set("working",!1),a.finish(11);case 14:case"end":return a.stop()}}return a}(),null,null,[[0,8,11,14]])}return e}(),(function(){return n.set("working",!1)})));case 9:case"end":return e.stop()}}return e}())}return e}(),'change input[type="checkbox"]':function(e,t){var n=this.id,r=t.state,a=r.get("settings"),s=a[n];if(s){var i=e.currentTarget.checked;s.value=i,s.hasChanged=s.oldValue!==s.value,r.set("settings",a)}},"change .rc-select__element":function(e,t){var n=this.id,r=t.state,a=r.get("settings"),s=a[n];if(s){var i=e.currentTarget.value;s.value=i,s.hasChanged=s.oldValue!==s.value,r.set("settings",a)}},'input input, input textarea, change input[type="color"]':h.throttle((function(e,t){var n=this.type,r=this.id,a=t.state,s=a.get("settings"),i=s[r];if(i){var u=e.currentTarget.value.trim();switch(n){case"int":u=parseInt(u);break;case"boolean":u="1"===u;break;case"code":u=$('.code-mirror-box[data-editor-id="'+r+'"] .CodeMirror')[0].CodeMirror.getValue()}i.value=u,i.hasChanged=i.oldValue!==i.value,a.set("settings",s)}}),500)})}

