function module(e,t,n){var r,i,o,a,s,c,u,p,l,m,d,g,f,h,_,k;function I(e){u.get("v1/getImportFileData").then((function(t){if(!t)return console.warn("The importer is not set up correctly, as it did not return any data."),s.error(c("Importer_not_setup")),i.go("/admin/import");if(t.waiting)setTimeout((function(){I(e)}),1e3);else{if(t.step)return console.warn("Invalid file, contains `data.step`.",t),s.error(c("Failed_To_Load_Import_Data")),i.go("/admin/import");e.users.set(t.users),e.channels.set(t.channels),e.message_count.set(t.message_count),e.preparing.set(!1),e.progressRate.set(!1)}})).catch((function(e){if(e)return _(e,"Failed_To_Load_Import_Data"),i.go("/admin/import")}))}function v(e){u.get("v1/getCurrentImportOperation").then((function(t){var n=t.operation;return n.valid?f.includes(n.status)?i.go("/admin/import/progress"):n.status===l.USER_SELECTION||g.includes(n.status)||d.includes(n.status)?(e.callbackRegistered||(k.registerCallback(e.progressUpdated),e.callbackRegistered=!0),I(e),e.preparing.set(!0)):m.includes(n.status)?(setTimeout((function(){v(e)}),1e3),e.preparing.set(!0)):h.includes(n.status)?(s.error(c("Import_Operation_Failed")),i.go("/admin/import")):n.status===l.DONE?i.go("/admin/import"):(s.error(c("Unknown_Import_State")),i.go("/admin/import")):i.go("/admin/import/new")})).catch((function(e){if(e)return s.error(c("Failed_To_Load_Import_Data")),i.go("/admin/import")}))}n.link("meteor/tracker",{Tracker:function(e){r=e}},0),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){i=e}},1),n.link("meteor/templating",{Template:function(e){o=e}},2),n.link("meteor/reactive-var",{ReactiveVar:function(e){a=e}},3),n.link("toastr",{default:function(e){s=e}},4),n.link("../../../utils",{t:function(e){c=e},APIClient:function(e){u=e}},5),n.link("../../../ui-utils/client",{SideNav:function(e){p=e}},6),n.link("../../lib/ImporterProgressStep",{ProgressStep:function(e){l=e},ImportWaitingStates:function(e){m=e},ImportFileReadyStates:function(e){d=e},ImportPreparingStartedStates:function(e){g=e},ImportingStartedStates:function(e){f=e},ImportingErrorStates:function(e){h=e}},7),n.link("../functions/showImporterException",{showImporterException:function(e){_=e}},8),n.link("..",{ImporterWebsocketReceiver:function(e){k=e}},9),n.link("./adminImportPrepare.html"),o.adminImportPrepare.helpers({isPreparing:function(){return o.instance().preparing.get()},hasProgressRate:function(){return!1!==o.instance().progressRate.get()},progressRate:function(){var e=o.instance().progressRate.get();return e?e+"%":""},pageTitle:function(){return c("Importing_Data")},users:function(){return o.instance().users.get()},channels:function(){return o.instance().channels.get()},message_count:function(){return o.instance().message_count.get()}}),o.adminImportPrepare.events({"click .button.start":function(e,t){var n;$(this).prop("disabled",!0);for(var r=0,o=Array.from(t.users.get());r<o.length;r++){var a=o[r];a.do_import=$("[name='"+a.user_id+"']").is(":checked")}for(var s=0,c=Array.from(t.channels.get());s<c.length;s++){var p=c[s];p.do_import=$("[name='"+p.channel_id+"']").is(":checked")}u.post("v1/startImport",{input:{users:t.users.get(),channels:t.channels.get()}}).then((function(){return t.users.set([]),t.channels.set([]),i.go("/admin/import/progress")})).catch((function(e){if(e)return _(e,"Failed_To_Start_Import"),i.go("/admin/import")}))},"click .button.uncheck-deleted-users":function(e,t){Array.from(t.users.get()).filter((function(e){return e.is_deleted})).map((function(e){var t=$("[name="+e.user_id+"]");return t&&t.length&&t[0].checked&&t.click()}))},"click .button.uncheck-archived-channels":function(e,t){Array.from(t.channels.get()).filter((function(e){return e.is_archived})).map((function(e){var t=$("[name="+e.channel_id+"]");return t&&t.length&&t[0].checked&&t.click()}))}}),o.adminImportPrepare.onCreated((function(){var e=this;this.preparing=new a(!0),this.progressRate=new a(!1),this.callbackRegistered=!1,this.users=new a([]),this.channels=new a([]),this.message_count=new a(0),this.progressUpdated=function(t){if("rate"in t){var n=t.rate;e.progressRate.set(n)}},v(this)})),o.adminImportPrepare.onRendered((function(){r.afterFlush((function(){p.setFlex("adminFlex"),p.openFlex()}))})),o.adminImportPrepare.onDestroyed((function(){this.callbackRegistered=!1,k.unregisterCallback(this.progressUpdated)}))}

