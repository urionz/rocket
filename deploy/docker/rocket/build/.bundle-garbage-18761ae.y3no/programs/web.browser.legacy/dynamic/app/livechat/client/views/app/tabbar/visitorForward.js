function module(e,t,n){var r,i,a,o,s,u,c,l,f,d;n.link("@babel/runtime/helpers/slicedToArray",{default:function(e){r=e}},0),n.link("@babel/runtime/regenerator",{default:function(e){i=e}},1),n.link("meteor/meteor",{Meteor:function(e){a=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){o=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){s=e}},2),n.link("meteor/templating",{Template:function(e){u=e}},3),n.link("toastr",{default:function(e){c=e}},4),n.link("../../../../../models",{ChatRoom:function(e){l=e}},5),n.link("../../../../../utils",{t:function(e){f=e}},6),n.link("./visitorForward.html"),n.link("../../../../../utils/client",{APIClient:function(e){d=e}},7),u.visitorForward.helpers({visitor:function(){return u.instance().visitor.get()},hasDepartments:function(){return u.instance().departments.get().filter((function(e){return!0===e.enabled})).length>0},departments:function(){return u.instance().departments.get().filter((function(e){return!0===e.enabled}))},agentName:function(){return this.name||this.username},onSelectAgents:function(){return u.instance().onSelectAgents},agentModifier:function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.get();return"@"+(0===n.length?t:t.replace(new RegExp(e.get()),(function(e){return"<strong>"+e+"</strong>"})))}},agentConditions:function(){var e,t,n=(u.instance().room.get()||{}).servedBy,r=(n=void 0===n?{}:n)._id,i;return{_id:r&&{$ne:r},status:{$ne:"offline"},statusLivechat:"available"}},selectedAgents:function(){return u.instance().selectedAgents.get()},onClickTagAgent:function(){return u.instance().onClickTagAgent}}),u.visitorForward.onCreated(function(){function e(){var e=this,t,n;return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return this.visitor=new o,this.room=new o,this.departments=new o([]),this.selectedAgents=new o([]),this.onSelectAgents=function(t){var n=t.item;e.selectedAgents.set([n])},this.onClickTagAgent=function(t){var n=t.username;e.selectedAgents.set(e.selectedAgents.get().filter((function(e){return e.username!==n})))},this.autorun((function(){e.visitor.set(a.users.findOne({_id:u.currentData().visitorId}))})),this.autorun((function(){e.room.set(l.findOne({_id:u.currentData().roomId}))})),r.next=10,i.awrap(d.v1.get("livechat/department"));case 10:t=r.sent,n=t.departments,this.departments.set(n);case 13:case"end":return r.stop()}}return r}(),null,this)}return e}()),u.visitorForward.events({"submit form":function(e,t){var n=this;e.preventDefault();var i={roomId:t.room.get()._id},o=t.selectedAgents.get(),u,l=r(o,1)[0];l?i.userId=l._id:t.find("#forwardDepartment").value&&(i.departmentId=t.find("#forwardDepartment").value),a.call("livechat:transfer",i,(function(e,t){e?c.error(f(e.error)):t?(n.save(),c.success(f("Transferred")),s.go("/")):c.warning(f("No_available_agents_to_transfer"))}))},"change #forwardDepartment, blur #forwardDepartment":function(e,t){e.currentTarget.value&&(t.find("#forwardUser").value="")},"change #forwardUser, blur #forwardUser":function(e,t){e.currentTarget.value&&t.find("#forwardDepartment")&&(t.find("#forwardDepartment").value="")},"click .cancel":function(e){e.preventDefault(),this.cancel()}})}

