function module(e,t,s){let a,n,r,i,p,o,d,l,c,g,u,h,A,m,k,P;s.link("@babel/runtime/helpers/objectSpread2",{default(e){a=e}},0),s.link("meteor/kadira:flow-router",{FlowRouter(e){n=e}},0),s.link("meteor/reactive-dict",{ReactiveDict(e){r=e}},1),s.link("meteor/templating",{Template(e){i=e}},2),s.link("meteor/tracker",{Tracker(e){p=e}},3),s.link("../../../settings",{settings(e){o=e}},4),s.link("../communication",{AppEvents(e){d=e}},5),s.link("../orchestrator",{Apps(e){l=e}},6),s.link("../../../ui-utils/client",{SideNav(e){c=e}},7),s.link("./helpers",{appButtonProps(e){g=e},appStatusSpanProps(e){u=e},checkCloudLogin(e){h=e},handleAPIError(e){A=e},promptSubscription(e){m=e},triggerAppPopoverMenu(e){k=e},warnStatusChange(e){P=e}},8),s.link("./apps.html"),i.apps.onCreated((function(){this.state=new r({apps:[],isLoading:!0,searchText:"",sortedColumn:"name",isAscendingOrder:!0,page:0,itemsPerPage:0,wasEndReached:!1}),(async()=>{try{const e=await l.getAppsFromMarketplace().catch(()=>[]),t=await l.getApps(),s=t.map(t=>{const s=e.find((function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e===t.id}));return a({},t,s?{installed:!0,categories:s.categories,marketplaceVersion:s.version}:{installed:!0})});this.state.set("apps",s)}catch(e){A(e)}finally{this.state.set("isLoading",!1)}})(),this.startAppWorking=e=>{const t=this.state.get("apps"),s=t.find(t=>{let{id:s}=t;return s===e});s.working=!0,this.state.set("apps",t)},this.stopAppWorking=e=>{const t=this.state.get("apps"),s=t.find(t=>{let{id:s}=t;return s===e});delete s.working,this.state.set("apps",t)},this.handleAppAddedOrUpdated=async e=>{try{const t=await l.getApp(e),{categories:s,version:n}=await l.getAppFromMarketplace(e,t.version)||{},r=[...this.state.get("apps").filter(t=>{let{id:s}=t;return s!==e}),a({},t,{installed:!0,categories:s,marketplaceVersion:n})];this.state.set("apps",r)}catch(t){A(t)}},this.handleAppRemoved=e=>{this.state.set("apps",this.state.get("apps").filter(t=>{let{id:s}=t;return s!==e}))},this.handleAppStatusChange=e=>{let{appId:t,status:s}=e;const a=this.state.get("apps"),n=a.find(e=>{let{id:s}=e;return s===t});n&&(n.status=s,this.state.set("apps",a))},l.getWsListener().registerListener(d.APP_ADDED,this.handleAppAddedOrUpdated),l.getWsListener().registerListener(d.APP_UPDATED,this.handleAppAddedOrUpdated),l.getWsListener().registerListener(d.APP_REMOVED,this.handleAppRemoved),l.getWsListener().registerListener(d.APP_STATUS_CHANGE,this.handleAppStatusChange)})),i.apps.onDestroyed((function(){l.getWsListener().unregisterListener(d.APP_ADDED,this.handleAppAddedOrUpdated),l.getWsListener().unregisterListener(d.APP_UPDATED,this.handleAppAddedOrUpdated),l.getWsListener().unregisterListener(d.APP_REMOVED,this.handleAppRemoved),l.getWsListener().unregisterListener(d.APP_STATUS_CHANGE,this.handleAppStatusChange)})),i.apps.onRendered(()=>{p.afterFlush(()=>{c.setFlex("adminFlex"),c.openFlex()})}),i.apps.helpers({isDevelopmentModeEnabled:()=>!0===o.get("Apps_Framework_Development_Mode"),isLoading:()=>i.instance().state.get("isLoading"),handleTableScroll(){const{state:e}=i.instance();if(!e.get("isLoading")&&!e.get("wasEndReached"))return t=>{let{offsetHeight:s,scrollTop:a,scrollHeight:n}=t;const r=s+a>=n-100;if(r)return e.set("page",e.get("page")+1)}},handleTableResize(){const{state:e}=i.instance();return function(){const t=this.$(".table-scroll");e.set("itemsPerPage",Math.ceil(t.height()/40+5))}},handleTableSort(){const{state:e}=i.instance();return t=>{e.set({page:0,wasEndReached:!1}),e.get("sortedColumn")!==t?e.set({sortedColumn:t,isAscendingOrder:!0}):e.set("isAscendingOrder",!e.get("isAscendingOrder"))}},isSortingBy:e=>i.instance().state.get("sortedColumn")===e,sortIcon(e){const{state:t}=i.instance();return e===t.get("sortedColumn")&&t.get("isAscendingOrder")?"sort-down":"sort-up"},apps(){const{state:e}=i.instance(),t=e.get("apps"),s=e.get("searchText").toLocaleLowerCase(),a=e.get("sortedColumn"),n=e.get("isAscendingOrder"),r=n?1:-1;return t.filter(e=>{let{name:t}=e;return t.toLocaleLowerCase().includes(s)}).sort((e,t)=>{let{[a]:s}=e,{[a]:n}=t;return r*String(s).localeCompare(String(n))})},appButtonProps:g,appStatusSpanProps:u}),i.apps.events({"click .js-marketplace"(){n.go("marketplace")},"click .js-upload"(){n.go("app-install")},"submit .js-search-form":e=>(e.stopPropagation(),!1),"input .js-search"(e,t){t.state.set("searchText",e.currentTarget.value)},"click .js-manage"(e,t){e.stopPropagation();const{currentTarget:s}=e,{id:a,version:r}=t.state.get("apps").find(e=>{let{id:t}=e;return t===s.dataset.id});n.go("app-manage",{appId:a},{version:r})},async"click .js-install, click .js-update"(e,t){if(e.preventDefault(),e.stopPropagation(),!(await h()))return;const{currentTarget:s}=e,a=t.state.get("apps").find(e=>{let{id:t}=e;return t===s.dataset.id});t.startAppWorking(a.id);try{const{status:e}=await l.installApp(a.id,a.marketplaceVersion);P(a.name,e)}catch(n){A(n)}finally{t.stopAppWorking(a.id)}},async"click .js-purchase"(e,t){if(e.preventDefault(),e.stopPropagation(),!(await h()))return;const{currentTarget:s}=e,a=t.state.get("apps").find(e=>{let{id:t}=e;return t===s.dataset.id});t.startAppWorking(a.id),await m(a,async()=>{try{const{status:e}=await l.installApp(a.id,a.marketplaceVersion);P(a.name,e)}catch(e){A(e)}finally{t.stopAppWorking(a.id)}},t.stopAppWorking.bind(t,a.id))},"click .js-menu"(e,t){e.stopPropagation();const{currentTarget:s}=e,a=t.state.get("apps").find(e=>{let{id:t}=e;return t===s.dataset.id});k(a,s,t)}})}

