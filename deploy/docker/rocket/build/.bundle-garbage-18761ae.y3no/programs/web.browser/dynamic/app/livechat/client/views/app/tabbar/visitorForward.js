function module(e,t,n){let r,a,s,i,o,l,d,c;n.link("meteor/meteor",{Meteor(e){r=e}},0),n.link("meteor/reactive-var",{ReactiveVar(e){a=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter(e){s=e}},2),n.link("meteor/templating",{Template(e){i=e}},3),n.link("toastr",{default(e){o=e}},4),n.link("../../../../../models",{ChatRoom(e){l=e}},5),n.link("../../../../../utils",{t(e){d=e}},6),n.link("./visitorForward.html"),n.link("../../../../../utils/client",{APIClient(e){c=e}},7),i.visitorForward.helpers({visitor:()=>i.instance().visitor.get(),hasDepartments:()=>i.instance().departments.get().filter(e=>!0===e.enabled).length>0,departments:()=>i.instance().departments.get().filter(e=>!0===e.enabled),agentName(){return this.name||this.username},onSelectAgents:()=>i.instance().onSelectAgents,agentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.get();return"@".concat(0===n.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),agentConditions(){const e=i.instance().room.get(),{servedBy:{_id:t}={}}=e||{},n=t&&{$ne:t};return{_id:n,status:{$ne:"offline"},statusLivechat:"available"}},selectedAgents:()=>i.instance().selectedAgents.get(),onClickTagAgent:()=>i.instance().onClickTagAgent}),i.visitorForward.onCreated((async function(){this.visitor=new a,this.room=new a,this.departments=new a([]),this.selectedAgents=new a([]),this.onSelectAgents=e=>{let{item:t}=e;this.selectedAgents.set([t])},this.onClickTagAgent=e=>{let{username:t}=e;this.selectedAgents.set(this.selectedAgents.get().filter(e=>e.username!==t))},this.autorun(()=>{this.visitor.set(r.users.findOne({_id:i.currentData().visitorId}))}),this.autorun(()=>{this.room.set(l.findOne({_id:i.currentData().roomId}))});const{departments:e}=await c.v1.get("livechat/department");this.departments.set(e)})),i.visitorForward.events({"submit form"(e,t){e.preventDefault();const n={roomId:t.room.get()._id},[a]=t.selectedAgents.get();a?n.userId=a._id:t.find("#forwardDepartment").value&&(n.departmentId=t.find("#forwardDepartment").value),r.call("livechat:transfer",n,(e,t)=>{e?o.error(d(e.error)):t?(this.save(),o.success(d("Transferred")),s.go("/")):o.warning(d("No_available_agents_to_transfer"))})},"change #forwardDepartment, blur #forwardDepartment"(e,t){e.currentTarget.value&&(t.find("#forwardUser").value="")},"change #forwardUser, blur #forwardUser"(e,t){e.currentTarget.value&&t.find("#forwardDepartment")&&(t.find("#forwardDepartment").value="")},"click .cancel"(e){e.preventDefault(),this.cancel()}})}

