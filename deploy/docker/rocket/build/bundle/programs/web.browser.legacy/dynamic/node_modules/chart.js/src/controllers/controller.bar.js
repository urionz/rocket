function module(e,t,a){"use strict";var r=e("../core/core.defaults"),n=e("../elements/index"),l=e("../helpers/index");function i(e,t){var a=e.isHorizontal()?e.width:e.height,r=e.getTicks(),n,l,i,o;for(i=1,o=t.length;i<o;++i)a=Math.min(a,t[i]-t[i-1]);for(i=0,o=r.length;i<o;++i)l=e.getPixelForTick(i),a=i>0?Math.min(a,l-n):a,n=l;return a}function o(e,t,a){var r=a.barThickness,n=t.stackCount,i=t.pixels[e],o,s;return l.isNullOrUndef(r)?(o=t.min*a.categoryPercentage,s=a.barPercentage):(o=r*n,s=1),{chunk:o/n,ratio:s,start:i-o/2}}function s(e,t,a){var r=t.pixels,n=r[e],l=e>0?r[e-1]:null,i=e<r.length-1?r[e+1]:null,o=a.categoryPercentage,s,c;return null===l&&(l=n-(null===i?t.end-n:i-n)),null===i&&(i=n+n-l),s=n-(n-l)/2*o,{chunk:(c=(i-l)/2*o)/t.stackCount,ratio:a.barPercentage,start:s}}r._set("bar",{hover:{mode:"label"},scales:{xAxes:[{type:"category",categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}],yAxes:[{type:"linear"}]}}),r._set("horizontalBar",{hover:{mode:"index",axis:"y"},scales:{xAxes:[{type:"linear",position:"bottom"}],yAxes:[{position:"left",type:"category",categoryPercentage:.8,barPercentage:.9,offset:!0,gridLines:{offsetGridLines:!0}}]},elements:{rectangle:{borderSkipped:"left"}},tooltips:{callbacks:{title:function(e,t){var a="";return e.length>0&&(e[0].yLabel?a=e[0].yLabel:t.labels.length>0&&e[0].index<t.labels.length&&(a=t.labels[e[0].index])),a},label:function(e,t){var a;return(t.datasets[e.datasetIndex].label||"")+": "+e.xLabel}},mode:"index",axis:"y"}}),a.exports=function(e){e.controllers.bar=e.DatasetController.extend({dataElementType:n.Rectangle,initialize:function(){var t=this,a;e.DatasetController.prototype.initialize.apply(t,arguments),(a=t.getMeta()).stack=t.getDataset().stack,a.bar=!0},update:function(e){var t=this,a=t.getMeta().data,r,n;for(t._ruler=t.getRuler(),r=0,n=a.length;r<n;++r)t.updateElement(a[r],r,e)},updateElement:function(e,t,a){var r=this,n=r.chart,i=r.getMeta(),o=r.getDataset(),s=e.custom||{},c=n.options.elements.rectangle;e._xScale=r.getScaleForId(i.xAxisID),e._yScale=r.getScaleForId(i.yAxisID),e._datasetIndex=r.index,e._index=t,e._model={datasetLabel:o.label,label:n.data.labels[t],borderSkipped:s.borderSkipped?s.borderSkipped:c.borderSkipped,backgroundColor:s.backgroundColor?s.backgroundColor:l.valueAtIndexOrDefault(o.backgroundColor,t,c.backgroundColor),borderColor:s.borderColor?s.borderColor:l.valueAtIndexOrDefault(o.borderColor,t,c.borderColor),borderWidth:s.borderWidth?s.borderWidth:l.valueAtIndexOrDefault(o.borderWidth,t,c.borderWidth)},r.updateElementGeometry(e,t,a),e.pivot()},updateElementGeometry:function(e,t,a){var r=this,n=e._model,l=r.getValueScale(),i=l.getBasePixel(),o=l.isHorizontal(),s=r._ruler||r.getRuler(),c=r.calculateBarValuePixels(r.index,t),d=r.calculateBarIndexPixels(r.index,t,s);n.horizontal=o,n.base=a?i:c.base,n.x=o?a?i:c.head:d.center,n.y=o?d.center:a?i:c.head,n.height=o?d.size:void 0,n.width=o?void 0:d.size},getValueScaleId:function(){return this.getMeta().yAxisID},getIndexScaleId:function(){return this.getMeta().xAxisID},getValueScale:function(){return this.getScaleForId(this.getValueScaleId())},getIndexScale:function(){return this.getScaleForId(this.getIndexScaleId())},_getStacks:function(e){var t=this,a=t.chart,r,n=t.getIndexScale().options.stacked,l=void 0===e?a.data.datasets.length:e+1,i=[],o,s;for(o=0;o<l;++o)(s=a.getDatasetMeta(o)).bar&&a.isDatasetVisible(o)&&(!1===n||!0===n&&-1===i.indexOf(s.stack)||void 0===n&&(void 0===s.stack||-1===i.indexOf(s.stack)))&&i.push(s.stack);return i},getStackCount:function(){return this._getStacks().length},getStackIndex:function(e,t){var a=this._getStacks(e),r=void 0!==t?a.indexOf(t):-1;return-1===r?a.length-1:r},getRuler:function(){var e=this,t=e.getIndexScale(),a=e.getStackCount(),r=e.index,n=t.isHorizontal(),o=n?t.left:t.top,s=o+(n?t.width:t.height),c=[],d,u,g;for(d=0,u=e.getMeta().data.length;d<u;++d)c.push(t.getPixelForValue(null,d,r));return{min:g=l.isNullOrUndef(t.options.barThickness)?i(t,c):-1,pixels:c,start:o,end:s,stackCount:a,scale:t}},calculateBarValuePixels:function(e,t){var a=this,r=a.chart,n=a.getMeta(),l=a.getValueScale(),i=r.data.datasets,o=l.getRightValue(i[e].data[t]),s=l.options.stacked,c=n.stack,d=0,u,g,h,x,b,f;if(s||void 0===s&&void 0!==c)for(u=0;u<e;++u)(g=r.getDatasetMeta(u)).bar&&g.stack===c&&g.controller.getValueScaleId()===l.id&&r.isDatasetVisible(u)&&(h=l.getRightValue(i[u].data[t]),(o<0&&h<0||o>=0&&h>0)&&(d+=h));return x=l.getPixelForValue(d),{size:f=((b=l.getPixelForValue(d+o))-x)/2,base:x,head:b,center:b+f/2}},calculateBarIndexPixels:function(e,t,a){var r=this,n=a.scale.options,i="flex"===n.barThickness?s(t,a,n):o(t,a,n),c=r.getStackIndex(e,r.getMeta().stack),d=i.start+i.chunk*c+i.chunk/2,u=Math.min(l.valueOrDefault(n.maxBarThickness,1/0),i.chunk*i.ratio);return{base:d-u/2,head:d+u/2,center:d,size:u}},draw:function(){var e=this,t=e.chart,a=e.getValueScale(),r=e.getMeta().data,n=e.getDataset(),i=r.length,o=0;for(l.canvas.clipArea(t.ctx,t.chartArea);o<i;++o)isNaN(a.getRightValue(n.data[o]))||r[o].draw();l.canvas.unclipArea(t.ctx)}}),e.controllers.horizontalBar=e.controllers.bar.extend({getValueScaleId:function(){return this.getMeta().xAxisID},getIndexScaleId:function(){return this.getMeta().yAxisID}})}}

