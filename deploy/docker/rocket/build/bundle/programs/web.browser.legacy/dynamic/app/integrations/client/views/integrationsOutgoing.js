function module(e,t,n){var r,a,i,o,s,l,c,u,m,d,g,v,f,h,p,_,k,y,C,b;n.link("@babel/runtime/regenerator",{default:function(e){r=e}},0),n.link("meteor/meteor",{Meteor:function(e){a=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){i=e}},1),n.link("meteor/random",{Random:function(e){o=e}},2),n.link("meteor/kadira:flow-router",{FlowRouter:function(e){s=e}},3),n.link("meteor/templating",{Template:function(e){l=e}},4),n.link("meteor/rocketchat:tap-i18n",{TAPi18n:function(e){c=e}},5),n.link("meteor/tracker",{Tracker:function(e){u=e}},6),n.link("highlight.js",{default:function(e){m=e}},7),n.link("toastr",{default:function(e){d=e}},8),n.link("./messageExample",{exampleMsg:function(e){g=e},exampleSettings:function(e){v=e},exampleUser:function(e){f=e}},9),n.link("../../../authorization",{hasAtLeastOnePermission:function(e){h=e}},10),n.link("../../../ui-utils",{modal:function(e){p=e},SideNav:function(e){_=e}},11),n.link("../../../utils/client",{t:function(e){k=e},handleError:function(e){y=e}},12),n.link("../../lib/rocketchat",{integrations:function(e){C=e}},13),n.link("../getIntegration",{getIntegration:function(e){b=e}},14),l.integrationsOutgoing.onCreated(function(){function e(){var e=this,t,n;return r.async(function(){function u(u){for(;;)switch(u.prev=u.next){case 0:return t=l.instance().data.params?l.instance().data.params():void 0,this.record=new i({username:"rocket.cat",token:o.id(24),retryFailedCalls:!0,retryCount:6,retryDelay:"powers-of-ten",runOnEdits:!0}),this.updateRecord=function(){e.record.set({enabled:"1"===$("[name=enabled]:checked").val().trim(),event:$("[name=event]").val().trim(),name:$("[name=name]").val().trim(),alias:$("[name=alias]").val().trim(),emoji:$("[name=emoji]").val().trim(),avatar:$("[name=avatar]").val().trim(),channel:$("[name=channel]").val()?$("[name=channel]").val().trim():void 0,username:$("[name=username]").val().trim(),triggerWords:$("[name=triggerWords]").val()?$("[name=triggerWords]").val().trim():void 0,urls:$("[name=urls]").val().trim(),token:$("[name=token]").val().trim(),scriptEnabled:"1"===$("[name=scriptEnabled]:checked").val().trim(),script:$("[name=script]").val().trim(),targetRoom:$("[name=targetRoom]").val()?$("[name=targetRoom]").val().trim():void 0,triggerWordAnywhere:"1"===$("[name=triggerWordAnywhere]:checked").val().trim(),retryFailedCalls:"1"===$("[name=retryFailedCalls]:checked").val().trim(),retryCount:$("[name=retryCount]").val()?$("[name=retryCount]").val().trim():6,retryDelay:$("[name=retryDelay]").val()?$("[name=retryDelay]").val().trim():"powers-of-ten",runOnEdits:"1"===$("[name=runOnEdits]:checked").val().trim()})},u.next=5,r.awrap(b(t.id,a.userId()));case 5:if(n=u.sent,!t.id||n){u.next=10;break}return d.error(c.__("No_integration_found")),s.go("admin-integrations"),u.abrupt("return");case 10:n.hasScriptError=n.scriptEnabled&&n.scriptError,this.record.set(n);case 12:case"end":return u.stop()}}return u}(),null,this)}return e}()),l.integrationsOutgoing.helpers({exampleMsg:g,exampleUser:f,exampleSettings:v,join:function(e,t){return e&&e.join?e.join(t):e},showHistoryButton:function(){return this.params&&this.params()&&void 0!==this.params().id},hasPermission:function(){return h(["manage-outgoing-integrations","manage-own-outgoing-integrations"])},data:function(){return l.instance().record.get()},canDelete:function(){return this.params&&this.params()&&void 0!==this.params().id},eventTypes:function(){return Object.values(C.outgoingEvents)},hasTypeSelected:function(){var e=l.instance().record.get();return"string"==typeof e.event&&""!==e.event},shouldDisplayChannel:function(){var e=l.instance().record.get();return"string"==typeof e.event&&C.outgoingEvents[e.event].use.channel},shouldDisplayTriggerWords:function(){var e=l.instance().record.get();return"string"==typeof e.event&&C.outgoingEvents[e.event].use.triggerWords},shouldDisplayTargetRoom:function(){var e=l.instance().record.get();return"string"==typeof e.event&&C.outgoingEvents[e.event].use.targetRoom},exampleJson:function(){var e=l.instance().record.get(),t={username:e.alias,icon_emoji:e.emoji,icon_url:e.avatar,text:"Response text",attachments:[{title:"Rocket.Chat",title_link:"https://rocket.chat",text:"Rocket.Chat, the best open source chat",image_url:"/images/integration-attachment-example.png",color:"#764FA5"}]},n=[null,""];return Object.keys(t).forEach((function(e){n.includes(t[e])&&delete t[e]})),m.highlight("json",JSON.stringify(t,null,2)).value},editorOptions:function(){return{lineNumbers:!0,mode:"javascript",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,matchBrackets:!0,autoCloseBrackets:!0,matchTags:!0,showTrailingSpace:!0,highlightSelectionMatches:!0}}}),l.integrationsOutgoing.events({"blur input":function(e,t){t.updateRecord()},"click input[type=radio]":function(e,t){t.updateRecord()},"change select[name=event]":function(e,t){var n=t.record.get();n.event=$("[name=event]").val().trim(),t.record.set(n)},"click .rc-button.history":function(){s.go("/admin/integrations/outgoing/"+s.getParam("id")+"/history")},"click .expand":function(e){$(e.currentTarget).closest(".section").removeClass("section-collapsed"),$(e.currentTarget).closest("button").removeClass("expand").addClass("collapse").find("span").text(c.__("Collapse")),$(".CodeMirror").each((function(e,t){return t.CodeMirror.refresh()}))},"click .collapse":function(e){$(e.currentTarget).closest(".section").addClass("section-collapsed"),$(e.currentTarget).closest("button").addClass("expand").removeClass("collapse").find("span").text(c.__("Expand"))},"click .rc-header__section-button > .delete":function(){var e=l.instance().data.params();p.open({title:k("Are_you_sure"),text:k("You_will_not_be_able_to_recover"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:k("Yes_delete_it"),cancelButtonText:k("Cancel"),closeOnConfirm:!1,html:!1},(function(){a.call("deleteOutgoingIntegration",e.id,(function(e){e?y(e):(p.open({title:k("Deleted"),text:k("Your_entry_has_been_deleted"),type:"success",timer:1e3,showConfirmButton:!1}),s.go("admin-integrations"))}))}))},"click .button-fullscreen":function(){$(".code-mirror-box").addClass("code-mirror-box-fullscreen content-background-color"),$(".CodeMirror")[0].CodeMirror.refresh()},"click .button-restore":function(){$(".code-mirror-box").removeClass("code-mirror-box-fullscreen content-background-color"),$(".CodeMirror")[0].CodeMirror.refresh()},"click .rc-header__section-button > .save":function(){var e=$("[name=event]").val().trim(),t=$("[name=enabled]:checked").val().trim(),n=$("[name=name]").val().trim(),r=$("[name=impersonateUser]:checked").val().trim(),i=$("[name=alias]").val().trim(),o=$("[name=emoji]").val().trim(),u=$("[name=avatar]").val().trim(),m=$("[name=username]").val().trim(),g=$("[name=token]").val().trim(),v=$("[name=scriptEnabled]:checked").val().trim(),f=$("[name=script]").val().trim(),h=$("[name=retryFailedCalls]:checked").val().trim(),p=$("[name=urls]").val().trim(),_,k,b,x,E,w,R;if(""===m&&"0"===r)return d.error(c.__("The_username_is_required"));if(0===(p=p.split("\n").filter((function(e){return""!==e.trim()}))).length)return d.error(c.__("You_should_inform_one_url_at_least"));if(C.outgoingEvents[e].use.triggerWords&&(_=(_=$("[name=triggerWords]").val().trim()).split(",").filter((function(e){return""!==e.trim()})),k=$("[name=triggerWordAnywhere]:checked").val().trim(),b=$("[name=runOnEdits]:checked").val().trim()),C.outgoingEvents[e].use.channel&&(!(x=$("[name=channel]").val().trim())||""===x.trim()))return d.error(c.__("error-the-field-is-required",{field:c.__("Channel")}));if(C.outgoingEvents[e].use.targetRoom&&(!(E=$("[name=targetRoom]").val().trim())||""===E.trim()))return d.error(c.__("error-the-field-is-required",{field:c.__("TargetRoom")}));"1"===h&&(w=parseInt($("[name=retryCount]").val().trim()),R=$("[name=retryDelay]").val().trim());var O={event:""!==e?e:void 0,enabled:"1"===t,username:m,channel:""!==x?x:void 0,targetRoom:""!==E?E:void 0,alias:""!==i?i:void 0,emoji:""!==o?o:void 0,avatar:""!==u?u:void 0,name:""!==n?n:void 0,triggerWords:""!==_?_:void 0,urls:""!==p?p:void 0,token:""!==g?g:void 0,script:""!==f?f:void 0,scriptEnabled:"1"===v,impersonateUser:"1"===r,retryFailedCalls:"1"===h,retryCount:w||6,retryDelay:R||"powers-of-ten",triggerWordAnywhere:"1"===k,runOnEdits:"1"===b},T=l.instance().data.params?l.instance().data.params():void 0;T&&T.id?a.call("updateOutgoingIntegration",T.id,O,(function(e){if(e)return y(e);d.success(c.__("Integration_updated"))})):a.call("addOutgoingIntegration",O,(function(e,t){if(e)return y(e);d.success(c.__("Integration_added")),s.go("admin-integrations-outgoing",{id:t._id})}))}}),l.integrationsOutgoing.onRendered((function(){u.afterFlush((function(){_.setFlex("adminFlex"),_.openFlex()}))}))}

