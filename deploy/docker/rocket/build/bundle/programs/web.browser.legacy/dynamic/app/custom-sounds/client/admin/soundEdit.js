function module(e,n,t){var i,o,a,s,u,l,r;t.link("meteor/meteor",{Meteor:function(e){i=e}},0),t.link("meteor/templating",{Template:function(e){o=e}},1),t.link("meteor/rocketchat:tap-i18n",{TAPi18n:function(e){a=e}},2),t.link("toastr",{default:function(e){s=e}},3),t.link("underscore.string",{default:function(e){u=e}},4),t.link("../../../utils",{t:function(e){l=e},handleError:function(e){r=e}},5),o.soundEdit.helpers({sound:function(){return o.instance().sound},name:function(){return this.name||this._id}}),o.soundEdit.events({"click .cancel":function(e,n){e.stopPropagation(),e.preventDefault(),delete o.instance().soundFile,n.cancel(n.find("form"))},"submit form":function(e,n){e.stopPropagation(),e.preventDefault(),n.save(e.currentTarget)},"change input[type=file]":function(e){var n=null!=e.originalEvent?e.originalEvent:e,t=n.target.files;for(var i in null!=n.target.files&&0!==t.length||(t=null!=n.dataTransfer.files?n.dataTransfer.files:[]),meteorBabelHelpers.sanitizeForInObject(t))t.hasOwnProperty(i)&&(o.instance().soundFile=t[i])}}),o.soundEdit.onCreated((function(){var e=this;null!=this.data?this.sound=this.data.sound:(this.sound=void 0,this.data.tabBar.showGroup("custom-sounds")),this.onSuccess=o.currentData().onSuccess,this.cancel=function(n,t){n.reset(),e.data.tabBar.close(),e.sound&&e.data.back(t)},this.getSoundData=function(){var n={};return null!=e.sound&&(n._id=e.sound._id,n.previousName=e.sound.name,n.extension=e.sound.extension,n.previousExtension=e.sound.extension),n.name=u.trim(e.$("#name").val()),n.newFile=!1,n},this.validate=function(){var n=e.getSoundData(),t=[];n.name||t.push("Name"),n._id||e.soundFile||t.push("Sound_File_mp3");for(var i=0,o=t;i<o.length;i++){var u=o[i];s.error(a.__("error-the-field-is-required",{field:a.__(u)}))}return e.soundFile&&(/audio\/mp3/.test(e.soundFile.type)||/audio\/mpeg/.test(e.soundFile.type)||/audio\/x-mpeg/.test(e.soundFile.type)||(t.push("FileType"),s.error(a.__("error-invalid-file-type")))),0===t.length},this.save=function(n){if(e.validate()){var t=e.getSoundData();e.soundFile&&(t.newFile=!0,t.extension=e.soundFile.name.split(".").pop(),t.type=e.soundFile.type),i.call("insertOrUpdateSound",t,(function(o,u){if(u){if(t._id=u,t.random=Math.round(1e3*Math.random()),e.soundFile){s.info(a.__("Uploading_file"));var d=new FileReader;d.readAsBinaryString(e.soundFile),d.onloadend=function(){i.call("uploadCustomSound",d.result,e.soundFile.type,t,(function(e){null!=e&&(r(e),console.log(e))})),delete e.soundFile,s.success(a.__("File_uploaded"))}}s.success(l("Custom_Sound_Saved_Successfully")),e.onSuccess(),e.cancel(n,t.name)}o&&r(o)}))}}}))}

