function module(t,e,a){"use strict";var n=t("./core.animation"),i=t("./core.animations"),o=t("./core.defaults"),s=t("../helpers/index"),r=t("./core.interaction"),l=t("./core.layouts"),c=t("../platforms/platform"),d=t("./core.plugins"),u=t("../core/core.scaleService"),f=t("./core.tooltip");a.exports=function(t){function e(t){var e=(t=t||{}).data=t.data||{};return e.datasets=e.datasets||[],e.labels=e.labels||[],t.options=s.configMerge(o.global,o[t.type],t.options||{}),t}function a(e){var a=e.options;s.each(e.scales,(function(t){l.removeBox(e,t)})),a=s.configMerge(t.defaults.global,t.defaults[e.config.type],a),e.options=e.config.options=a,e.ensureScalesHaveIDs(),e.buildOrUpdateScales(),e.tooltip._options=a.tooltips,e.tooltip.initialize()}function p(t){return"top"===t||"bottom"===t}t.types={},t.instances={},t.controllers={},s.extend(t.prototype,{construct:function(a,n){var i=this;n=e(n);var o=c.acquireContext(a,n),r=o&&o.canvas,l=r&&r.height,d=r&&r.width;i.id=s.uid(),i.ctx=o,i.canvas=r,i.config=n,i.width=d,i.height=l,i.aspectRatio=l?d/l:null,i.options=n.options,i._bufferedRender=!1,i.chart=i,i.controller=i,t.instances[i.id]=i,Object.defineProperty(i,"data",{get:function(){return i.config.data},set:function(t){i.config.data=t}}),o&&r?(i.initialize(),i.update()):console.error("Failed to create chart: can't acquire context from the given item")},initialize:function(){var t=this;return d.notify(t,"beforeInit"),s.retinaScale(t,t.options.devicePixelRatio),t.bindEvents(),t.options.responsive&&t.resize(!0),t.ensureScalesHaveIDs(),t.buildOrUpdateScales(),t.initToolTip(),d.notify(t,"afterInit"),t},clear:function(){return s.canvas.clear(this),this},stop:function(){return i.cancelAnimation(this),this},resize:function(t){var e=this,a=e.options,n=e.canvas,i=a.maintainAspectRatio&&e.aspectRatio||null,o=Math.max(0,Math.floor(s.getMaximumWidth(n))),r=Math.max(0,Math.floor(i?o/i:s.getMaximumHeight(n)));if((e.width!==o||e.height!==r)&&(n.width=e.width=o,n.height=e.height=r,n.style.width=o+"px",n.style.height=r+"px",s.retinaScale(e,a.devicePixelRatio),!t)){var l={width:o,height:r};d.notify(e,"resize",[l]),e.options.onResize&&e.options.onResize(e,l),e.stop(),e.update({duration:e.options.responsiveAnimationDuration})}},ensureScalesHaveIDs:function(){var t=this.options,e=t.scales||{},a=t.scale;s.each(e.xAxes,(function(t,e){t.id=t.id||"x-axis-"+e})),s.each(e.yAxes,(function(t,e){t.id=t.id||"y-axis-"+e})),a&&(a.id=a.id||"scale")},buildOrUpdateScales:function(){var t=this,e=t.options,a=t.scales||{},n=[],i=Object.keys(a).reduce((function(t,e){return t[e]=!1,t}),{});e.scales&&(n=n.concat((e.scales.xAxes||[]).map((function(t){return{options:t,dtype:"category",dposition:"bottom"}})),(e.scales.yAxes||[]).map((function(t){return{options:t,dtype:"linear",dposition:"left"}})))),e.scale&&n.push({options:e.scale,dtype:"radialLinear",isDefault:!0,dposition:"chartArea"}),s.each(n,(function(e){var n=e.options,o=n.id,r=s.valueOrDefault(n.type,e.dtype);p(n.position)!==p(e.dposition)&&(n.position=e.dposition),i[o]=!0;var l=null;if(o in a&&a[o].type===r)(l=a[o]).options=n,l.ctx=t.ctx,l.chart=t;else{var c=u.getScaleConstructor(r);if(!c)return;l=new c({id:o,type:r,options:n,ctx:t.ctx,chart:t}),a[l.id]=l}l.mergeTicksOptions(),e.isDefault&&(t.scale=l)})),s.each(i,(function(t,e){t||delete a[e]})),t.scales=a,u.addScalesToLayout(this)},buildOrUpdateControllers:function(){var e=this,a=[],n=[];return s.each(e.data.datasets,(function(i,o){var s=e.getDatasetMeta(o),r=i.type||e.config.type;if(s.type&&s.type!==r&&(e.destroyDatasetMeta(o),s=e.getDatasetMeta(o)),s.type=r,a.push(s.type),s.controller)s.controller.updateIndex(o),s.controller.linkScales();else{var l=t.controllers[s.type];if(void 0===l)throw new Error('"'+s.type+'" is not a chart type.');s.controller=new l(e,o),n.push(s.controller)}}),e),n},resetElements:function(){var t=this;s.each(t.data.datasets,(function(e,a){t.getDatasetMeta(a).controller.reset()}),t)},reset:function(){this.resetElements(),this.tooltip.initialize()},update:function(t){var e=this;if(t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]}),a(e),d._invalidate(e),!1!==d.notify(e,"beforeUpdate")){e.tooltip._data=e.data;var n=e.buildOrUpdateControllers();s.each(e.data.datasets,(function(t,a){e.getDatasetMeta(a).controller.buildOrUpdateElements()}),e),e.updateLayout(),e.options.animation&&e.options.animation.duration&&s.each(n,(function(t){t.reset()})),e.updateDatasets(),e.tooltip.initialize(),e.lastActive=[],d.notify(e,"afterUpdate"),e._bufferedRender?e._bufferedRequest={duration:t.duration,easing:t.easing,lazy:t.lazy}:e.render(t)}},updateLayout:function(){var t=this;!1!==d.notify(t,"beforeLayout")&&(l.update(this,this.width,this.height),d.notify(t,"afterScaleUpdate"),d.notify(t,"afterLayout"))},updateDatasets:function(){var t=this;if(!1!==d.notify(t,"beforeDatasetsUpdate")){for(var e=0,a=t.data.datasets.length;e<a;++e)t.updateDataset(e);d.notify(t,"afterDatasetsUpdate")}},updateDataset:function(t){var e=this,a=e.getDatasetMeta(t),n={meta:a,index:t};!1!==d.notify(e,"beforeDatasetUpdate",[n])&&(a.controller.update(),d.notify(e,"afterDatasetUpdate",[n]))},render:function(t){var e=this;t&&"object"==typeof t||(t={duration:t,lazy:arguments[1]});var a=t.duration,o=t.lazy;if(!1!==d.notify(e,"beforeRender")){var r=e.options.animation,l=function(t){d.notify(e,"afterRender"),s.callback(r&&r.onComplete,[t],e)};if(r&&(void 0!==a&&0!==a||void 0===a&&0!==r.duration)){var c=new n({numSteps:(a||r.duration)/16.66,easing:t.easing||r.easing,render:function(t,e){var a=s.easing.effects[e.easing],n=e.currentStep,i=n/e.numSteps;t.draw(a(i),i,n)},onAnimationProgress:r.onProgress,onAnimationComplete:l});i.addAnimation(e,c,a,o)}else e.draw(),l(new n({numSteps:0,chart:e}));return e}},draw:function(t){var e=this;e.clear(),s.isNullOrUndef(t)&&(t=1),e.transition(t),e.width<=0||e.height<=0||!1!==d.notify(e,"beforeDraw",[t])&&(s.each(e.boxes,(function(t){t.draw(e.chartArea)}),e),e.scale&&e.scale.draw(),e.drawDatasets(t),e._drawTooltip(t),d.notify(e,"afterDraw",[t]))},transition:function(t){for(var e=this,a=0,n=(e.data.datasets||[]).length;a<n;++a)e.isDatasetVisible(a)&&e.getDatasetMeta(a).controller.transition(t);e.tooltip.transition(t)},drawDatasets:function(t){var e=this;if(!1!==d.notify(e,"beforeDatasetsDraw",[t])){for(var a=(e.data.datasets||[]).length-1;a>=0;--a)e.isDatasetVisible(a)&&e.drawDataset(a,t);d.notify(e,"afterDatasetsDraw",[t])}},drawDataset:function(t,e){var a=this,n=a.getDatasetMeta(t),i={meta:n,index:t,easingValue:e};!1!==d.notify(a,"beforeDatasetDraw",[i])&&(n.controller.draw(e),d.notify(a,"afterDatasetDraw",[i]))},_drawTooltip:function(t){var e=this,a=e.tooltip,n={tooltip:a,easingValue:t};!1!==d.notify(e,"beforeTooltipDraw",[n])&&(a.draw(),d.notify(e,"afterTooltipDraw",[n]))},getElementAtEvent:function(t){return r.modes.single(this,t)},getElementsAtEvent:function(t){return r.modes.label(this,t,{intersect:!0})},getElementsAtXAxis:function(t){return r.modes["x-axis"](this,t,{intersect:!0})},getElementsAtEventForMode:function(t,e,a){var n=r.modes[e];return"function"==typeof n?n(this,t,a):[]},getDatasetAtEvent:function(t){return r.modes.dataset(this,t,{intersect:!0})},getDatasetMeta:function(t){var e=this,a=e.data.datasets[t];a._meta||(a._meta={});var n=a._meta[e.id];return n||(n=a._meta[e.id]={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null}),n},getVisibleDatasetCount:function(){for(var t=0,e=0,a=this.data.datasets.length;e<a;++e)this.isDatasetVisible(e)&&t++;return t},isDatasetVisible:function(t){var e=this.getDatasetMeta(t);return"boolean"==typeof e.hidden?!e.hidden:!this.data.datasets[t].hidden},generateLegend:function(){return this.options.legendCallback(this)},destroyDatasetMeta:function(t){var e=this.id,a=this.data.datasets[t],n=a._meta&&a._meta[e];n&&(n.controller.destroy(),delete a._meta[e])},destroy:function(){var e=this,a=e.canvas,n,i;for(e.stop(),n=0,i=e.data.datasets.length;n<i;++n)e.destroyDatasetMeta(n);a&&(e.unbindEvents(),s.canvas.clear(e),c.releaseContext(e.ctx),e.canvas=null,e.ctx=null),d.notify(e,"destroy"),delete t.instances[e.id]},toBase64Image:function(){return this.canvas.toDataURL.apply(this.canvas,arguments)},initToolTip:function(){var t=this;t.tooltip=new f({_chart:t,_chartInstance:t,_data:t.data,_options:t.options.tooltips},t)},bindEvents:function(){var t=this,e=t._listeners={},a=function(){t.eventHandler.apply(t,arguments)};s.each(t.options.events,(function(n){c.addEventListener(t,n,a),e[n]=a})),t.options.responsive&&(a=function(){t.resize()},c.addEventListener(t,"resize",a),e.resize=a)},unbindEvents:function(){var t=this,e=t._listeners;e&&(delete t._listeners,s.each(e,(function(e,a){c.removeEventListener(t,a,e)})))},updateHoverStyle:function(t,e,a){var n=a?"setHoverStyle":"removeHoverStyle",i,o,s;for(o=0,s=t.length;o<s;++o)(i=t[o])&&this.getDatasetMeta(i._datasetIndex).controller[n](i)},eventHandler:function(t){var e=this,a=e.tooltip;if(!1!==d.notify(e,"beforeEvent",[t])){e._bufferedRender=!0,e._bufferedRequest=null;var n=e.handleEvent(t);a&&(n=a._start?a.handleEvent(t):n|a.handleEvent(t)),d.notify(e,"afterEvent",[t]);var i=e._bufferedRequest;return i?e.render(i):n&&!e.animating&&(e.stop(),e.render({duration:e.options.hover.animationDuration,lazy:!0})),e._bufferedRender=!1,e._bufferedRequest=null,e}},handleEvent:function(t){var e=this,a=e.options||{},n=a.hover,i=!1;return e.lastActive=e.lastActive||[],"mouseout"===t.type?e.active=[]:e.active=e.getElementsAtEventForMode(t,n.mode,n),s.callback(a.onHover||a.hover.onHover,[t.native,e.active],e),"mouseup"!==t.type&&"click"!==t.type||a.onClick&&a.onClick.call(e,t.native,e.active),e.lastActive.length&&e.updateHoverStyle(e.lastActive,n.mode,!1),e.active.length&&n.mode&&e.updateHoverStyle(e.active,n.mode,!0),i=!s.arrayEquals(e.active,e.lastActive),e.lastActive=e.active,i}}),t.Controller=t}}

