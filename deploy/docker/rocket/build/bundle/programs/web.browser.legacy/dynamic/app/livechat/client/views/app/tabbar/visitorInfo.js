function module(t,e,n){var i,o,r,s,a,c,u,l,f,d,m,v,h,g,p,_,w,k,I,y,C,b,D;n.link("@babel/runtime/regenerator",{default:function(t){i=t}},0),n.link("meteor/meteor",{Meteor:function(t){o=t}},0),n.link("meteor/reactive-var",{ReactiveVar:function(t){r=t}},1),n.link("meteor/kadira:flow-router",{FlowRouter:function(t){s=t}},2),n.link("meteor/session",{Session:function(t){a=t}},3),n.link("meteor/templating",{Template:function(t){c=t}},4),n.link("meteor/rocketchat:tap-i18n",{TAPi18n:function(t){u=t}},5),n.link("underscore",{default:function(t){l=t}},6),n.link("underscore.string",{default:function(t){f=t}},7),n.link("moment",{default:function(t){d=t}},8),n.link("ua-parser-js",{default:function(t){m=t}},9),n.link("../../../../../ui-utils",{modal:function(t){v=t}},10),n.link("../../../../../models",{Subscriptions:function(t){h=t}},11),n.link("../../../../../settings",{settings:function(t){g=t}},12),n.link("../../../../../utils",{t:function(t){p=t},handleError:function(t){_=t},roomTypes:function(t){w=t}},13),n.link("../../../../../authorization",{hasRole:function(t){k=t},hasPermission:function(t){I=t},hasAtLeastOnePermission:function(t){y=t}},14),n.link("./visitorInfo.html"),n.link("../../../../../utils/client",{APIClient:function(t){C=t}},15),n.link("../../../../../ui-utils/client",{RoomManager:function(t){b=t}},16),n.link("../../../../../lib/client",{DateFormat:function(t){D=t}},17);var B=function(){var t=c.currentData(),e;return!(!t||!t.rid)&&void 0!==h.findOne({rid:t.rid})};c.visitorInfo.helpers({user:function(){var t=c.instance().user.get();if(t&&t.userAgent){var e=new m;e.setUA(t.userAgent),t.os=e.getOS().name+" "+e.getOS().version,-1!==["Mac OS","iOS"].indexOf(e.getOS().name)?t.osIcon="icon-apple":t.osIcon="icon-"+e.getOS().name.toLowerCase(),t.browser=e.getBrowser().name+" "+e.getBrowser().version,t.browserIcon="icon-"+e.getBrowser().name.toLowerCase(),t.status=w.getUserStatus("l",this.rid)||"offline"}return t},room:function(){return c.instance().room.get()},department:function(){return c.instance().department.get()},joinTags:function(){var t=c.instance().tags.get();return t&&t.join(", ")},customRoomFields:function(){var t=c.instance().customFields.get();if(!t||0===t.length)return[];var e=[],n,i,o=(c.instance().room.get()||{}).livechatData,r=void 0===o?{}:o;return Object.keys(r).forEach((function(n){var i=l.findWhere(t,{_id:n});i&&"hidden"!==i.visibility&&"room"===i.scope&&e.push({label:i.label,value:r[n]})})),e},customVisitorFields:function(){var t=c.instance().customFields.get();if(!t||0===t.length)return[];var e=[],n,i,o=(c.instance().user.get()||{}).livechatData,r=void 0===o?{}:o;return Object.keys(r).forEach((function(n){var i=l.findWhere(t,{_id:n});i&&"hidden"!==i.visibility&&"visitor"===i.scope&&e.push({label:i.label,value:r[n]})})),e},createdAt:function(){return this.createdAt?d(this.createdAt).format("L LTS"):""},lastLogin:function(){return this.lastLogin?d(this.lastLogin).format("L LTS"):""},editing:function(){return"edit"===c.instance().action.get()},forwarding:function(){return"forward"===c.instance().action.get()},editDetails:function(){var t=c.instance(),e=t.user.get();return{visitorId:e?e._id:null,roomId:this.rid,save:function(){t.action.set()},cancel:function(){t.action.set()}}},forwardDetails:function(){var t=c.instance(),e=t.user.get();return{visitorId:e?e._id:null,roomId:this.rid,save:function(){t.action.set()},cancel:function(){t.action.set()}}},roomOpen:function(){var t=c.instance().room.get(),e=o.userId();return t&&t.open&&(t.servedBy&&t.servedBy._id===e||k(e,"livechat-manager"))},canReturnQueue:function(){var t;return c.instance().routingConfig.get().returnQueue},showDetail:function(){if(c.instance().action.get())return"hidden"},canSeeButtons:function(){return!!y(["close-others-livechat-room","transfer-livechat-guest"])||B()},canEditRoom:function(){return!!I("save-others-livechat-room-info")||B()},canCloseRoom:function(){return!!I("close-others-livechat-room")||B()},canForwardGuest:function(){return I("transfer-livechat-guest")},roomClosedDateTime:function(){var t=this.closedAt;return D.formatDateAndTime(t)},roomClosedBy:function(){var t=this.closedBy,e=void 0===t?{}:t,n=this.servedBy,i=void 0===n?{}:n,o=this.closer;if("user"===o){if(i._id!==e._id)return e.username;o="agent"}var r=o.charAt(0).toUpperCase()+o.slice(1);return p(""+r)}}),c.visitorInfo.events({"click .edit-livechat":function(t,e){t.preventDefault(),e.action.set("edit")},"click .close-livechat":function(t){var e=this;t.preventDefault();var n=function(t){return o.call("livechat:closeRoom",e.rid,t,(function(t){if(t)return _(t);v.open({title:p("Chat_closed"),text:p("Chat_closed_successfully"),type:"success",timer:1e3,showConfirmButton:!1})}))};if(!g.get("Livechat_request_comment_when_closing_conversation")){var i=u.__("Chat_closed_by_agent");return n(i)}v.open({title:p("Closing_chat"),type:"input",inputPlaceholder:p("Please_add_a_comment"),showCancelButton:!0,closeOnConfirm:!1},(function(t){return t?""===f.trim(t)?(v.showInputError(p("Please_add_a_comment_to_close_the_room")),!1):n(t):(v.showInputError(p("Please_add_a_comment_to_close_the_room")),!1)}))},"click .return-inquiry":function(t){var e=this;t.preventDefault(),v.open({title:p("Would_you_like_to_return_the_inquiry"),type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:p("Yes")},(function(){o.call("livechat:returnAsInquiry",e.rid,(function(t){t?_(t):(a.set("openedRoom"),s.go("/home"))}))}))},"click .forward-livechat":function(t,e){t.preventDefault(),e.action.set("forward")}}),c.visitorInfo.onCreated((function(){var t=this;this.visitorId=new r(null),this.customFields=new r([]),this.action=new r,this.user=new r,this.departmentId=new r(null),this.tags=new r(null),this.routingConfig=new r({}),this.department=new r({}),this.room=new r({}),this.updateRoom=function(e){t.room.set(e)},o.call("livechat:getCustomFields",(function(e,n){n&&t.customFields.set(n)}));var e,n=c.currentData().rid;o.call("livechat:getRoutingConfig",(function(e,n){n&&t.routingConfig.set(n)}));var s=function(){function e(e){var n,o;return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.awrap(C.v1.get("rooms.info?roomId="+e));case 2:n=r.sent,o=n.room,t.visitorId.set(o&&o.v&&o.v._id),t.departmentId.set(o&&o.departmentId),t.tags.set(o&&o.tags),t.room.set(o);case 8:case"end":return r.stop()}}return r}())}return e}();n&&(s(n),b.roomStream.on(n,this.updateRoom)),this.autorun(function(){function e(){var e,n;return i.async(function(){function o(o){for(;;)switch(o.prev=o.next){case 0:if(!t.departmentId.get()){o.next=6;break}return o.next=3,i.awrap(C.v1.get("livechat/department/"+t.departmentId.get()+"?includeAgents=false"));case 3:e=o.sent,n=e.department,t.department.set(n);case 6:case"end":return o.stop()}}return o}())}return e}()),this.autorun(function(){function e(){var e,n,o;return i.async(function(){function r(r){for(;;)switch(r.prev=r.next){case 0:if(!(e=t.visitorId.get())){r.next=7;break}return r.next=4,i.awrap(C.v1.get("livechat/visitors.info?visitorId="+e));case 4:n=r.sent,o=n.visitor,t.user.set(o);case 7:case"end":return r.stop()}}return r}())}return e}())})),c.visitorInfo.onDestroyed((function(){var t,e=c.currentData().rid;b.roomStream.removeListener(e,this.updateRoom)}))}

