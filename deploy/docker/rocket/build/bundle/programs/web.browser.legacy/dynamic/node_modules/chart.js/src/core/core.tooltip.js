function module(t,e,o){"use strict";var n=t("./core.defaults"),i=t("./core.element"),r=t("../helpers/index");n._set("global",{tooltips:{enabled:!0,custom:null,mode:"nearest",position:"average",intersect:!0,backgroundColor:"rgba(0,0,0,0.8)",titleFontStyle:"bold",titleSpacing:2,titleMarginBottom:6,titleFontColor:"#fff",titleAlign:"left",bodySpacing:2,bodyFontColor:"#fff",bodyAlign:"left",footerFontStyle:"bold",footerSpacing:2,footerMarginTop:6,footerFontColor:"#fff",footerAlign:"left",yPadding:6,xPadding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,callbacks:{beforeTitle:r.noop,title:function(t,e){var o="",n=e.labels,i=n?n.length:0;if(t.length>0){var r=t[0];r.xLabel?o=r.xLabel:i>0&&r.index<i&&(o=n[r.index])}return o},afterTitle:r.noop,beforeBody:r.noop,beforeLabel:r.noop,label:function(t,e){var o=e.datasets[t.datasetIndex].label||"";return o&&(o+=": "),o+=t.yLabel},labelColor:function(t,e){var o,n,i=e.getDatasetMeta(t.datasetIndex).data[t.index]._view;return{borderColor:i.borderColor,backgroundColor:i.backgroundColor}},labelTextColor:function(){return this._options.bodyFontColor},afterLabel:r.noop,afterBody:r.noop,beforeFooter:r.noop,footer:r.noop,afterFooter:r.noop}}});var l={average:function(t){if(!t.length)return!1;var e,o,n=0,i=0,r=0;for(e=0,o=t.length;e<o;++e){var l=t[e];if(l&&l.hasValue()){var a=l.tooltipPosition();n+=a.x,i+=a.y,++r}}return{x:Math.round(n/r),y:Math.round(i/r)}},nearest:function(t,e){var o=e.x,n=e.y,i=Number.POSITIVE_INFINITY,l,a,d;for(l=0,a=t.length;l<a;++l){var f=t[l];if(f&&f.hasValue()){var c=f.getCenterPoint(),y=r.distanceBetweenPoints(e,c);y<i&&(i=y,d=f)}}if(d){var g=d.tooltipPosition();o=g.x,n=g.y}return{x:o,y:n}}},e;function a(t,e){var o=r.color(t);return o.alpha(e*o.alpha()).rgbaString()}function d(t,e){return e&&(r.isArray(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function f(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function c(t){var e=t._xScale,o=t._yScale||t._scale,n=t._index,i=t._datasetIndex;return{xLabel:e?e.getLabelForIndex(n,i):"",yLabel:o?o.getLabelForIndex(n,i):"",index:n,datasetIndex:i,x:t._model.x,y:t._model.y}}function y(t){var e=n.global,o=r.valueOrDefault;return{xPadding:t.xPadding,yPadding:t.yPadding,xAlign:t.xAlign,yAlign:t.yAlign,bodyFontColor:t.bodyFontColor,_bodyFontFamily:o(t.bodyFontFamily,e.defaultFontFamily),_bodyFontStyle:o(t.bodyFontStyle,e.defaultFontStyle),_bodyAlign:t.bodyAlign,bodyFontSize:o(t.bodyFontSize,e.defaultFontSize),bodySpacing:t.bodySpacing,titleFontColor:t.titleFontColor,_titleFontFamily:o(t.titleFontFamily,e.defaultFontFamily),_titleFontStyle:o(t.titleFontStyle,e.defaultFontStyle),titleFontSize:o(t.titleFontSize,e.defaultFontSize),_titleAlign:t.titleAlign,titleSpacing:t.titleSpacing,titleMarginBottom:t.titleMarginBottom,footerFontColor:t.footerFontColor,_footerFontFamily:o(t.footerFontFamily,e.defaultFontFamily),_footerFontStyle:o(t.footerFontStyle,e.defaultFontStyle),footerFontSize:o(t.footerFontSize,e.defaultFontSize),_footerAlign:t.footerAlign,footerSpacing:t.footerSpacing,footerMarginTop:t.footerMarginTop,caretSize:t.caretSize,cornerRadius:t.cornerRadius,backgroundColor:t.backgroundColor,opacity:0,legendColorBackground:t.multiKeyBackground,displayColors:t.displayColors,borderColor:t.borderColor,borderWidth:t.borderWidth}}function g(t,e){var o=t._chart.ctx,n=2*e.yPadding,i=0,l=e.body,a=l.reduce((function(t,e){return t+e.before.length+e.lines.length+e.after.length}),0);a+=e.beforeBody.length+e.afterBody.length;var d=e.title.length,f=e.footer.length,c=e.titleFontSize,y=e.bodyFontSize,g=e.footerFontSize;n+=d*c,n+=d?(d-1)*e.titleSpacing:0,n+=d?e.titleMarginBottom:0,n+=a*y,n+=a?(a-1)*e.bodySpacing:0,n+=f?e.footerMarginTop:0,n+=f*g,n+=f?(f-1)*e.footerSpacing:0;var h=0,u=function(t){i=Math.max(i,o.measureText(t).width+h)};return o.font=r.fontString(c,e._titleFontStyle,e._titleFontFamily),r.each(e.title,u),o.font=r.fontString(y,e._bodyFontStyle,e._bodyFontFamily),r.each(e.beforeBody.concat(e.afterBody),u),h=e.displayColors?y+2:0,r.each(l,(function(t){r.each(t.before,u),r.each(t.lines,u),r.each(t.after,u)})),h=0,o.font=r.fontString(g,e._footerFontStyle,e._footerFontFamily),r.each(e.footer,u),{width:i+=2*e.xPadding,height:n}}function h(t,e){var o=t._model,n=t._chart,i=t._chart.chartArea,r="center",l="center",a,d,f,c,y;o.y<e.height?l="top":o.y>n.height-e.height&&(l="bottom");var g=(i.left+i.right)/2,h=(i.top+i.bottom)/2;"center"===l?(a=function(t){return t<=g},d=function(t){return t>g}):(a=function(t){return t<=e.width/2},d=function(t){return t>=n.width-e.width/2}),f=function(t){return t+e.width+o.caretSize+o.caretPadding>n.width},c=function(t){return t-e.width-o.caretSize-o.caretPadding<0},y=function(t){return t<=h?"top":"bottom"},a(o.x)?(r="left",f(o.x)&&(r="center",l=y(o.y))):d(o.x)&&(r="right",c(o.x)&&(r="center",l=y(o.y)));var u=t._options;return{xAlign:u.xAlign?u.xAlign:r,yAlign:u.yAlign?u.yAlign:l}}function u(t,e,o,n){var i=t.x,r=t.y,l=t.caretSize,a=t.caretPadding,d=t.cornerRadius,f=o.xAlign,c=o.yAlign,y=l+a,g=d+a;return"right"===f?i-=e.width:"center"===f&&((i-=e.width/2)+e.width>n.width&&(i=n.width-e.width),i<0&&(i=0)),"top"===c?r+=y:r-="bottom"===c?e.height+y:e.height/2,"center"===c?"left"===f?i+=y:"right"===f&&(i-=y):"left"===f?i-=g:"right"===f&&(i+=g),{x:i,y:r}}function s(t){return d([],f(t))}(o.exports=i.extend({initialize:function(){this._model=y(this._options),this._lastActive=[]},getTitle:function(){var t=this,e=t._options,o=e.callbacks,n=o.beforeTitle.apply(t,arguments),i=o.title.apply(t,arguments),r=o.afterTitle.apply(t,arguments),l=[];return l=d(l,f(n)),l=d(l,f(i)),l=d(l,f(r))},getBeforeBody:function(){return s(this._options.callbacks.beforeBody.apply(this,arguments))},getBody:function(t,e){var o=this,n=o._options.callbacks,i=[];return r.each(t,(function(t){var r={before:[],lines:[],after:[]};d(r.before,f(n.beforeLabel.call(o,t,e))),d(r.lines,n.label.call(o,t,e)),d(r.after,f(n.afterLabel.call(o,t,e))),i.push(r)})),i},getAfterBody:function(){return s(this._options.callbacks.afterBody.apply(this,arguments))},getFooter:function(){var t=this,e=t._options.callbacks,o=e.beforeFooter.apply(t,arguments),n=e.footer.apply(t,arguments),i=e.afterFooter.apply(t,arguments),r=[];return r=d(r,f(o)),r=d(r,f(n)),r=d(r,f(i))},update:function(t){var e=this,o=e._options,n=e._model,i=e._model=y(o),a=e._active,d=e._data,f={xAlign:n.xAlign,yAlign:n.yAlign},s={x:n.x,y:n.y},b={width:n.width,height:n.height},p={x:n.caretX,y:n.caretY},x,F;if(a.length){i.opacity=1;var S=[],_=[];p=l[o.position].call(e,a,e._eventPosition);var v=[];for(x=0,F=a.length;x<F;++x)v.push(c(a[x]));o.filter&&(v=v.filter((function(t){return o.filter(t,d)}))),o.itemSort&&(v=v.sort((function(t,e){return o.itemSort(t,e,d)}))),r.each(v,(function(t){S.push(o.callbacks.labelColor.call(e,t,e._chart)),_.push(o.callbacks.labelTextColor.call(e,t,e._chart))})),i.title=e.getTitle(v,d),i.beforeBody=e.getBeforeBody(v,d),i.body=e.getBody(v,d),i.afterBody=e.getAfterBody(v,d),i.footer=e.getFooter(v,d),i.x=Math.round(p.x),i.y=Math.round(p.y),i.caretPadding=o.caretPadding,i.labelColors=S,i.labelTextColors=_,i.dataPoints=v,s=u(i,b=g(this,i),f=h(this,b),e._chart)}else i.opacity=0;return i.xAlign=f.xAlign,i.yAlign=f.yAlign,i.x=s.x,i.y=s.y,i.width=b.width,i.height=b.height,i.caretX=p.x,i.caretY=p.y,e._model=i,t&&o.custom&&o.custom.call(e,i),e},drawCaret:function(t,e){var o=this._chart.ctx,n=this._view,i=this.getCaretPosition(t,e,n);o.lineTo(i.x1,i.y1),o.lineTo(i.x2,i.y2),o.lineTo(i.x3,i.y3)},getCaretPosition:function(t,e,o){var n,i,r,l,a,d,f=o.caretSize,c=o.cornerRadius,y=o.xAlign,g=o.yAlign,h=t.x,u=t.y,s=e.width,b=e.height;if("center"===g)a=u+b/2,"left"===y?(i=(n=h)-f,r=n,l=a+f,d=a-f):(i=(n=h+s)+f,r=n,l=a-f,d=a+f);else if("left"===y?(n=(i=h+c+f)-f,r=i+f):"right"===y?(n=(i=h+s-c-f)-f,r=i+f):(n=(i=o.caretX)-f,r=i+f),"top"===g)a=(l=u)-f,d=l;else{a=(l=u+b)+f,d=l;var p=r;r=n,n=p}return{x1:n,x2:i,x3:r,y1:l,y2:a,y3:d}},drawTitle:function(t,e,o,n){var i=e.title;if(i.length){o.textAlign=e._titleAlign,o.textBaseline="top";var l=e.titleFontSize,d=e.titleSpacing,f,c;for(o.fillStyle=a(e.titleFontColor,n),o.font=r.fontString(l,e._titleFontStyle,e._titleFontFamily),f=0,c=i.length;f<c;++f)o.fillText(i[f],t.x,t.y),t.y+=l+d,f+1===i.length&&(t.y+=e.titleMarginBottom-d)}},drawBody:function(t,e,o,n){var i=e.bodyFontSize,l=e.bodySpacing,d=e.body;o.textAlign=e._bodyAlign,o.textBaseline="top",o.font=r.fontString(i,e._bodyFontStyle,e._bodyFontFamily);var f=0,c=function(e){o.fillText(e,t.x+f,t.y),t.y+=i+l};o.fillStyle=a(e.bodyFontColor,n),r.each(e.beforeBody,c);var y=e.displayColors;f=y?i+2:0,r.each(d,(function(l,d){var f=a(e.labelTextColors[d],n);o.fillStyle=f,r.each(l.before,c),r.each(l.lines,(function(r){y&&(o.fillStyle=a(e.legendColorBackground,n),o.fillRect(t.x,t.y,i,i),o.lineWidth=1,o.strokeStyle=a(e.labelColors[d].borderColor,n),o.strokeRect(t.x,t.y,i,i),o.fillStyle=a(e.labelColors[d].backgroundColor,n),o.fillRect(t.x+1,t.y+1,i-2,i-2),o.fillStyle=f),c(r)})),r.each(l.after,c)})),f=0,r.each(e.afterBody,c),t.y-=l},drawFooter:function(t,e,o,n){var i=e.footer;i.length&&(t.y+=e.footerMarginTop,o.textAlign=e._footerAlign,o.textBaseline="top",o.fillStyle=a(e.footerFontColor,n),o.font=r.fontString(e.footerFontSize,e._footerFontStyle,e._footerFontFamily),r.each(i,(function(n){o.fillText(n,t.x,t.y),t.y+=e.footerFontSize+e.footerSpacing})))},drawBackground:function(t,e,o,n,i){o.fillStyle=a(e.backgroundColor,i),o.strokeStyle=a(e.borderColor,i),o.lineWidth=e.borderWidth;var r=e.xAlign,l=e.yAlign,d=t.x,f=t.y,c=n.width,y=n.height,g=e.cornerRadius;o.beginPath(),o.moveTo(d+g,f),"top"===l&&this.drawCaret(t,n),o.lineTo(d+c-g,f),o.quadraticCurveTo(d+c,f,d+c,f+g),"center"===l&&"right"===r&&this.drawCaret(t,n),o.lineTo(d+c,f+y-g),o.quadraticCurveTo(d+c,f+y,d+c-g,f+y),"bottom"===l&&this.drawCaret(t,n),o.lineTo(d+g,f+y),o.quadraticCurveTo(d,f+y,d,f+y-g),"center"===l&&"left"===r&&this.drawCaret(t,n),o.lineTo(d,f+g),o.quadraticCurveTo(d,f,d+g,f),o.closePath(),o.fill(),e.borderWidth>0&&o.stroke()},draw:function(){var t=this._chart.ctx,e=this._view;if(0!==e.opacity){var o={width:e.width,height:e.height},n={x:e.x,y:e.y},i=Math.abs(e.opacity<.001)?0:e.opacity,r=e.title.length||e.beforeBody.length||e.body.length||e.afterBody.length||e.footer.length;this._options.enabled&&r&&(this.drawBackground(n,e,t,o,i),n.x+=e.xPadding,n.y+=e.yPadding,this.drawTitle(n,e,t,i),this.drawBody(n,e,t,i),this.drawFooter(n,e,t,i))}},handleEvent:function(t){var e=this,o=e._options,n=!1;return e._lastActive=e._lastActive||[],"mouseout"===t.type?e._active=[]:e._active=e._chart.getElementsAtEventForMode(t,o.mode,o),(n=!r.arrayEquals(e._active,e._lastActive))&&(e._lastActive=e._active,(o.enabled||o.custom)&&(e._eventPosition={x:t.x,y:t.y},e.update(!0),e.pivot())),n}})).positioners=l}

