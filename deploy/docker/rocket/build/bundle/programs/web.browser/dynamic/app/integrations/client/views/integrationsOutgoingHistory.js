function module(t,e,i){let a,n,o,s,r,l,c,d,g,h,u,m,p,f,y,k,_,v;i.link("@babel/runtime/helpers/objectSpread2",{default(t){a=t}},0),i.link("meteor/meteor",{Meteor(t){n=t}},0),i.link("meteor/reactive-var",{ReactiveVar(t){o=t}},1),i.link("meteor/kadira:flow-router",{FlowRouter(t){s=t}},2),i.link("meteor/templating",{Template(t){r=t}},3),i.link("meteor/rocketchat:tap-i18n",{TAPi18n(t){l=t}},4),i.link("meteor/tracker",{Tracker(t){c=t}},5),i.link("underscore",{default(t){d=t}},6),i.link("highlight.js",{default(t){g=t}},7),i.link("moment",{default(t){h=t}},8),i.link("toastr",{default(t){u=t}},9),i.link("../../../utils",{handleError(t){m=t}},10),i.link("../../../authorization",{hasAtLeastOnePermission(t){p=t}},11),i.link("../../lib/rocketchat",{integrations(t){f=t}},12),i.link("../../../ui-utils/client",{SideNav(t){y=t}},13),i.link("../../../utils/client",{APIClient(t){k=t}},14),i.link("../getIntegration",{getIntegration(t){_=t}},15),i.link("../streamer",{integrationHistoryStreamer(t){v=t}},16);const C=25;r.integrationsOutgoingHistory.onCreated((async function t(){const e=r.instance().data.params?r.instance().data.params():void 0;if(this.isLoading=new o(!1),this.history=new o([]),this.offset=new o(0),this.total=new o(0),e&&e.id){v.on(e.id,t=>{let{type:e,id:i,diff:n,data:o}=t;const s=this.history.get();if("inserted"!==e){if("updated"===e){const t=s.find(t=>{let{_id:e}=t;return e===i});return Object.assign(t,n),void this.history.set(s)}"removed"===e&&this.history.set([])}else this.history.set([a({},o)].concat(s))});const t=await _(e.id,n.userId());if(!t)return u.error(l.__("No_integration_found")),s.go("admin-integrations");this.autorun(async()=>{this.isLoading.set(!0);const{history:e,total:i}=await k.v1.get("integrations.history?id=".concat(t._id,"&count=").concat(25,"&offset=").concat(this.offset.get()));this.history.set(this.history.get().concat(e)),this.total.set(i),this.isLoading.set(!1)})}else u.error(l.__("No_integration_found")),s.go("admin-integrations")})),r.integrationsOutgoingHistory.helpers({hasPermission:()=>p(["manage-outgoing-integrations","manage-own-outgoing-integrations"]),isLoading:()=>r.instance().isLoading.get(),histories:()=>r.instance().history.get().sort((t,e)=>+t._updatedAt<+e._updatedAt?1:+t._updatedAt>+e._updatedAt?-1:0),hasProperty:(t,e)=>void 0!==t[e]||null!=t[e],iconClass:t=>void 0!==t.error&&t.error?"icon-cancel-circled error-color":t.finished?"icon-ok-circled success-color":"icon-help-circled",statusI18n:t=>void 0!==t&&t?l.__("Failure"):l.__("Success"),formatDate:t=>h(t).format("L LTS"),formatDateDetail:t=>h(t).format("L HH:mm:ss:SSSS"),eventTypei18n:t=>l.__(f.outgoingEvents[t].label),jsonStringify:t=>t?"object"==typeof t?g.highlight("json",JSON.stringify(t,null,2)).value:g.highlight("json",t).value:"",integrationId(){return this.params&&this.params()&&this.params().id}}),r.integrationsOutgoingHistory.events({"click .expand":t=>{$(t.currentTarget).closest(".section").removeClass("section-collapsed"),$(t.currentTarget).closest("button").removeClass("expand").addClass("collapse").find("span").text(l.__("Collapse")),$(".CodeMirror").each((t,e)=>e.CodeMirror.refresh())},"click .collapse":t=>{$(t.currentTarget).closest(".section").addClass("section-collapsed"),$(t.currentTarget).closest("button").addClass("expand").removeClass("collapse").find("span").text(l.__("Expand"))},"click .replay":(t,e)=>{if(!(e&&e.data&&e.data.params&&e.data.params().id))return;const i=$(t.currentTarget).attr("data-history-id");n.call("replayOutgoingIntegration",{integrationId:e.data.params().id,historyId:i},t=>{t&&m(t)})},"click .clear-history":(t,e)=>{e&&e.data&&e.data.params&&e.data.params().id&&n.call("clearIntegrationHistory",e.data.params().id,t=>{t?m(t):(u.success(l.__("Integration_History_Cleared")),e.history.set([]))})},"scroll .content":d.throttle((t,e)=>{const i=e.history.get();t.target.scrollTop>=t.target.scrollHeight-t.target.clientHeight&&e.total.get()>i.length&&e.offset.set(e.offset.get()+25)},200)}),r.integrationsOutgoingHistory.onRendered(()=>{c.afterFlush(()=>{y.setFlex("adminFlex"),y.openFlex()})})}

