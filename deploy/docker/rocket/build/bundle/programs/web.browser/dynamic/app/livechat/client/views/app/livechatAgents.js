function module(e,t,n){let a,s,i,l,o,r,c,g,u,d,h,m,f;n.link("meteor/meteor",{Meteor(e){a=e}},0),n.link("meteor/templating",{Template(e){s=e}},1),n.link("meteor/kadira:flow-router",{FlowRouter(e){i=e}},2),n.link("meteor/reactive-var",{ReactiveVar(e){l=e}},3),n.link("meteor/reactive-dict",{ReactiveDict(e){o=e}},4),n.link("underscore",{default(e){r=e}},5),n.link("../../../../ui-utils",{modal(e){c=e},call(e){g=e},TabBar(e){u=e},RocketChatTabBar(e){d=e}},6),n.link("../../../../utils/client",{t(e){h=e},handleError(e){m=e},APIClient(e){f=e}},7),n.link("./livechatAgents.html");const v=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=arguments.length>2?arguments[2]:void 0,a="livechat/users/agent?count=".concat(t);n&&(a+="&text=".concat(encodeURIComponent(n)));const{users:s}=await f.v1.get(a);e.agents.set(s),e.ready.set(!0)},A=e=>e.username;s.livechatAgents.helpers({exceptionsAgents(){const{selectedAgents:e}=s.instance();return s.instance().agents.get().map(A).concat(e.get().map(A))},deleteLastAgent(){const e=s.instance();return()=>{const t=e.selectedAgents.curValue;t.pop(),e.selectedAgents.set(t)}},isLoading:()=>s.instance().state.get("loading"),agents:()=>s.instance().agents.get(),emailAddress(){if(this.emails&&this.emails.length>0)return this.emails[0].address},agentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.get();return"@".concat(0===n.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),onSelectAgents:()=>s.instance().onSelectAgents,selectedAgents:()=>s.instance().selectedAgents.get(),onClickTagAgents:()=>s.instance().onClickTagAgents,isReady(){const e=s.instance();return e.ready&&e.ready.get()},onTableScroll(){const e=s.instance();return function(t){if(t.offsetHeight+t.scrollTop>=t.scrollHeight-100)return e.limit.set(e.limit.get()+50)}},flexData:()=>({tabBar:s.instance().tabBar,data:s.instance().tabBarData.get()})});const p=300;s.livechatAgents.events({"click .remove-agent"(e,t){e.preventDefault(),c.open({title:h("Are_you_sure"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:h("Yes"),cancelButtonText:h("Cancel"),closeOnConfirm:!1,html:!1},()=>{a.call("livechat:removeAgent",this.username,(async function(e){if(e)return m(e);"opened"===t.tabBar.getState()&&t.tabBar.close(),await v(t),c.open({title:h("Removed"),text:h("Agent_removed"),type:"success",timer:1e3,showConfirmButton:!1})}))})},async"submit #form-agent"(e,t){e.preventDefault();const{selectedAgents:n,state:a,limit:s,filter:i}=t,l=n.get();if(l.length){a.set("loading",!0);try{await Promise.all(l.map(e=>{let{username:t}=e;return g("livechat:addAgent",t)})),await v(t,s.get(),i.get()),n.set([])}finally{a.set("loading",!1)}}},"keydown #agents-filter"(e){13===e.which&&(e.stopPropagation(),e.preventDefault())},"keyup #agents-filter":r.debounce((e,t)=>{e.preventDefault(),t.filter.set(e.currentTarget.value)},300),"click .user-info"(e,t){e.preventDefault(),t.tabBarData.set({agentId:this._id,onRemoveAgent:()=>v(t)}),t.tabBar.setData({label:h("Agent_Info"),icon:"livechat"}),t.tabBar.open("livechat-agent-info")}}),s.livechatAgents.onCreated((function(){const e=this;this.limit=new l(50),this.filter=new l(""),this.state=new o({loading:!1}),this.ready=new l(!0),this.selectedAgents=new l([]),this.agents=new l([]),this.tabBar=new d,this.tabBar.showGroup(i.current().route.name),this.tabBarData=new l,u.addButton({groups:["livechat-agent-users"],id:"livechat-agent-info",i18nTitle:"Agent_Info",icon:"livechat",template:"agentInfo",order:1}),this.onSelectAgents=e=>{let{item:t}=e;this.selectedAgents.set([...this.selectedAgents.curValue,t])},this.onClickTagAgents=e=>{let{username:t}=e;this.selectedAgents.set(this.selectedAgents.curValue.filter(e=>e.username!==t))},this.autorun((function(){const t=e.limit.get(),n=e.filter.get();v(e,t,n)}))}))}

