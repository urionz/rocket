function module(e,t,i){"use strict";var n=e("../core/core.defaults"),l=e("../core/core.element"),a=e("../helpers/index"),o=e("../core/core.layouts"),d=a.noop;function r(e,t){return e.usePointStyle?t*Math.SQRT2:e.boxWidth}n._set("global",{legend:{display:!0,position:"top",fullWidth:!0,reverse:!1,weight:1e3,onClick:function(e,t){var i=t.datasetIndex,n=this.chart,l=n.getDatasetMeta(i);l.hidden=null===l.hidden?!n.data.datasets[i].hidden:null,n.update()},onHover:null,labels:{boxWidth:40,padding:10,generateLabels:function(e){var t=e.data;return a.isArray(t.datasets)?t.datasets.map((function(t,i){return{text:t.label,fillStyle:a.isArray(t.backgroundColor)?t.backgroundColor[0]:t.backgroundColor,hidden:!e.isDatasetVisible(i),lineCap:t.borderCapStyle,lineDash:t.borderDash,lineDashOffset:t.borderDashOffset,lineJoin:t.borderJoinStyle,lineWidth:t.borderWidth,strokeStyle:t.borderColor,pointStyle:t.pointStyle,datasetIndex:i}}),this):[]}}},legendCallback:function(e){var t=[];t.push('<ul class="'+e.id+'-legend">');for(var i=0;i<e.data.datasets.length;i++)t.push('<li><span style="background-color:'+e.data.datasets[i].backgroundColor+'"></span>'),e.data.datasets[i].label&&t.push(e.data.datasets[i].label),t.push("</li>");return t.push("</ul>"),t.join("")}});var s=l.extend({initialize:function(e){a.extend(this,e),this.legendHitBoxes=[],this.doughnutMode=!1},beforeUpdate:d,update:function(e,t,i){var n=this;return n.beforeUpdate(),n.maxWidth=e,n.maxHeight=t,n.margins=i,n.beforeSetDimensions(),n.setDimensions(),n.afterSetDimensions(),n.beforeBuildLabels(),n.buildLabels(),n.afterBuildLabels(),n.beforeFit(),n.fit(),n.afterFit(),n.afterUpdate(),n.minSize},afterUpdate:d,beforeSetDimensions:d,setDimensions:function(){var e=this;e.isHorizontal()?(e.width=e.maxWidth,e.left=0,e.right=e.width):(e.height=e.maxHeight,e.top=0,e.bottom=e.height),e.paddingLeft=0,e.paddingTop=0,e.paddingRight=0,e.paddingBottom=0,e.minSize={width:0,height:0}},afterSetDimensions:d,beforeBuildLabels:d,buildLabels:function(){var e=this,t=e.options.labels||{},i=a.callback(t.generateLabels,[e.chart],e)||[];t.filter&&(i=i.filter((function(i){return t.filter(i,e.chart.data)}))),e.options.reverse&&i.reverse(),e.legendItems=i},afterBuildLabels:d,beforeFit:d,fit:function(){var e=this,t=e.options,i=t.labels,l=t.display,o=e.ctx,d=n.global,s=a.valueOrDefault,h=s(i.fontSize,d.defaultFontSize),f=s(i.fontStyle,d.defaultFontStyle),u=s(i.fontFamily,d.defaultFontFamily),g=a.fontString(h,f,u),p=e.legendHitBoxes=[],c=e.minSize,b=e.isHorizontal();if(b?(c.width=e.maxWidth,c.height=l?10:0):(c.width=l?10:0,c.height=e.maxHeight),l)if(o.font=g,b){var m=e.lineWidths=[0],v=e.legendItems.length?h+i.padding:0;o.textAlign="left",o.textBaseline="top",a.each(e.legendItems,(function(t,n){var l,a=r(i,h)+h/2+o.measureText(t.text).width;m[m.length-1]+a+i.padding>=e.width&&(v+=h+i.padding,m[m.length]=e.left),p[n]={left:0,top:0,width:a,height:h},m[m.length-1]+=a+i.padding})),c.height+=v}else{var x=i.padding,y=e.columnWidths=[],S=i.padding,k=0,D=0,w=h+x;a.each(e.legendItems,(function(e,t){var n,l=r(i,h)+h/2+o.measureText(e.text).width;D+w>c.height&&(S+=k+i.padding,y.push(k),k=0,D=0),k=Math.max(k,l),D+=w,p[t]={left:0,top:0,width:l,height:h}})),S+=k,y.push(k),c.width+=S}e.width=c.width,e.height=c.height},afterFit:d,isHorizontal:function(){return"top"===this.options.position||"bottom"===this.options.position},draw:function(){var e=this,t=e.options,i=t.labels,l=n.global,o=l.elements.line,d=e.width,s=e.lineWidths;if(t.display){var h=e.ctx,f=a.valueOrDefault,u=f(i.fontColor,l.defaultFontColor),g=f(i.fontSize,l.defaultFontSize),p=f(i.fontStyle,l.defaultFontStyle),c=f(i.fontFamily,l.defaultFontFamily),b=a.fontString(g,p,c),m;h.textAlign="left",h.textBaseline="middle",h.lineWidth=.5,h.strokeStyle=u,h.fillStyle=u,h.font=b;var v=r(i,g),x=e.legendHitBoxes,y=function(e,i,n){if(!(isNaN(v)||v<=0)){h.save(),h.fillStyle=f(n.fillStyle,l.defaultColor),h.lineCap=f(n.lineCap,o.borderCapStyle),h.lineDashOffset=f(n.lineDashOffset,o.borderDashOffset),h.lineJoin=f(n.lineJoin,o.borderJoinStyle),h.lineWidth=f(n.lineWidth,o.borderWidth),h.strokeStyle=f(n.strokeStyle,l.defaultColor);var d=0===f(n.lineWidth,o.borderWidth);if(h.setLineDash&&h.setLineDash(f(n.lineDash,o.borderDash)),t.labels&&t.labels.usePointStyle){var r=g*Math.SQRT2/2,s=r/Math.SQRT2,u=e+s,p=i+s;a.canvas.drawPoint(h,n.pointStyle,r,u,p)}else d||h.strokeRect(e,i,v,g),h.fillRect(e,i,v,g);h.restore()}},S=function(e,t,i,n){var l=g/2,a=v+l+e,o=t+l;h.fillText(i.text,a,o),i.hidden&&(h.beginPath(),h.lineWidth=2,h.moveTo(a,o),h.lineTo(a+n,o),h.stroke())},k=e.isHorizontal();m=k?{x:e.left+(d-s[0])/2,y:e.top+i.padding,line:0}:{x:e.left+i.padding,y:e.top+i.padding,line:0};var D=g+i.padding;a.each(e.legendItems,(function(t,n){var l=h.measureText(t.text).width,a=v+g/2+l,o=m.x,r=m.y;k?o+a>=d&&(r=m.y+=D,m.line++,o=m.x=e.left+(d-s[m.line])/2):r+D>e.bottom&&(o=m.x=o+e.columnWidths[m.line]+i.padding,r=m.y=e.top+i.padding,m.line++),y(o,r,t),x[n].left=o,x[n].top=r,S(o,r,t,l),k?m.x+=a+i.padding:m.y+=D}))}},handleEvent:function(e){var t=this,i=t.options,n="mouseup"===e.type?"click":e.type,l=!1;if("mousemove"===n){if(!i.onHover)return}else{if("click"!==n)return;if(!i.onClick)return}var a=e.x,o=e.y;if(a>=t.left&&a<=t.right&&o>=t.top&&o<=t.bottom)for(var d=t.legendHitBoxes,r=0;r<d.length;++r){var s=d[r];if(a>=s.left&&a<=s.left+s.width&&o>=s.top&&o<=s.top+s.height){if("click"===n){i.onClick.call(t,e.native,t.legendItems[r]),l=!0;break}if("mousemove"===n){i.onHover.call(t,e.native,t.legendItems[r]),l=!0;break}}}return l}});function h(e,t){var i=new s({ctx:e.ctx,options:t,chart:e});o.configure(e,i,t),o.addBox(e,i),e.legend=i}i.exports={id:"legend",_element:s,beforeInit:function(e){var t=e.options.legend;t&&h(e,t)},beforeUpdate:function(e){var t=e.options.legend,i=e.legend;t?(a.mergeIf(t,n.global.legend),i?(o.configure(e,i,t),i.options=t):h(e,t)):i&&(o.removeBox(e,i),delete e.legend)},afterEvent:function(e,t){var i=e.legend;i&&i.handleEvent(t)}}}

