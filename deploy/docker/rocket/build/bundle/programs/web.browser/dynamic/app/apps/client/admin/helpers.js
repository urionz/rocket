function module(t,e,n){let a,i,r,o,c,l,s,p,u;n.export({handleAPIError:()=>_,warnStatusChange:()=>f,checkCloudLogin:()=>h,promptSubscription:()=>w,triggerAppPopoverMenu:()=>k,appButtonProps:()=>D,appStatusSpanProps:()=>I,formatPrice:()=>S,formatPricingPlan:()=>E}),n.link("@rocket.chat/apps-engine/definition/AppStatus",{AppStatus(t){a=t}},0),n.link("meteor/kadira:flow-router",{FlowRouter(t){i=t}},1),n.link("semver",{default(t){r=t}},2),n.link("toastr",{default(t){o=t}},3),n.link("../../../ui-utils/client",{modal(t){c=t},popover(t){l=t},call(t){s=t}},4),n.link("../../../utils/client",{t(t){p=t}},5),n.link("../orchestrator",{Apps(t){u=t}},6);const d=[a.AUTO_ENABLED,a.MANUALLY_ENABLED],m=[a.COMPILER_ERROR_DISABLED,a.ERROR_DISABLED,a.INVALID_SETTINGS_DISABLED,a.INVALID_LICENSE_DISABLED],_=t=>{console.error(t);const e=t.xhr&&t.xhr.responseJSON&&t.xhr.responseJSON.error||t.message;o.error(e)},f=(t,e)=>{m.includes(e)?o.error(p("App_status_".concat(e)),t):o.info(p("App_status_".concat(e)),t)},A=()=>{c.open({title:p("Apps_Marketplace_Login_Required_Title"),text:p("Apps_Marketplace_Login_Required_Description"),type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:p("Login"),cancelButtonText:p("Cancel"),closeOnConfirm:!0,html:!1},t=>{t&&i.go("cloud-config")})},h=async()=>{try{const t=await s("cloud:checkUserLoggedIn");return t||A(),t}catch(t){return _(t),!1}},w=async(t,e,n)=>{let a=null;try{a=await u.buildExternalUrl(t.id,t.purchaseType,!1)}catch(i){return _(i),void n()}c.open({allowOutsideClick:!1,data:a,template:"iframeModal"},e,n)},y=async t=>{let{id:e,purchaseType:n}=t;if(!(await h()))return;let a=null;try{a=await u.buildExternalUrl(e,n,!0)}catch(i){return void _(i)}await new Promise(t=>{c.open({allowOutsideClick:!1,data:a,template:"iframeModal"},t)})},b=()=>new Promise(t=>{c.open({text:p("Apps_Marketplace_Deactivate_App_Prompt"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:p("Yes"),cancelButtonText:p("No"),closeOnConfirm:!0,html:!1},t,()=>t(!1))}),B=()=>new Promise(t=>{c.open({text:p("Apps_Marketplace_Uninstall_App_Prompt"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:p("Yes"),cancelButtonText:p("No"),closeOnConfirm:!0,html:!1},t,()=>t(!1))}),g=()=>new Promise(t=>{c.open({text:p("Apps_Marketplace_Uninstall_Subscribed_App_Prompt"),type:"info",showCancelButton:!0,confirmButtonText:p("Apps_Marketplace_Modify_App_Subscription"),cancelButtonText:p("Apps_Marketplace_Uninstall_Subscribed_App_Anyway"),cancelButtonColor:"#DD6B55",closeOnConfirm:!0,html:!1},t,()=>t(!1))}),k=(t,e,n)=>{if(!t)return;const a="subscription"===t.purchaseType,r=t.subscriptionInfo&&["active","trialing"].includes(t.subscriptionInfo.status),o=d.includes(t.status),c=async()=>{await y(t);try{await u.syncApp(t.id)}catch(e){_(e)}},s=()=>{i.go("app-logs",{appId:t.id},{version:t.version})},m=async()=>{if(await b())try{const e=await u.disableApp(t.id);f(t.name,e)}catch(e){_(e)}},A=async()=>{try{const e=await u.enableApp(t.id);f(t.name,e)}catch(e){_(e)}},h=async()=>{if(r){const n=await g();if(n){await y(t);try{await u.syncApp(t.id)}catch(e){_(e)}return}try{await u.uninstallApp(t.id)}catch(e){_(e)}}else if(await B())try{await u.uninstallApp(t.id)}catch(e){_(e)}};l.open({currentTarget:e,instance:n,columns:[{groups:[{items:[...a?[{icon:"card",name:p("Subscription"),action:c}]:[],{icon:"list-alt",name:p("View_Logs"),action:s}]},{items:[o?{icon:"ban",name:p("Disable"),modifier:"alert",action:m}:{icon:"check",name:p("Enable"),action:A},{icon:"trash",name:p("Uninstall"),modifier:"alert",action:h}]}]}]})},D=t=>{let{installed:e,version:n,marketplaceVersion:a,isPurchased:i,price:o,purchaseType:c,subscriptionInfo:l}=t;const s=e&&n&&a&&r.lt(n,a);if(s)return{action:"update",icon:"reload",label:"Update"};if(e)return;const p=i;if(p)return{action:"install",label:"Install"};const u="subscription"===c&&!l.status;if(u)return{action:"purchase",label:"Trial"};const d=o>0;return d?{action:"purchase",label:"Buy"}:{action:"purchase",label:"Install"}},I=t=>{let{installed:e,status:n,subscriptionInfo:i}=t;if(!e)return;const r=m.includes(n);if(r)return{type:"failed",icon:"warning",label:n===a.INVALID_SETTINGS_DISABLED?"Config Needed":"Failed"};const o=d.includes(n);if(!o)return{type:"warning",icon:"warning",label:"Disabled"};const c=i&&"trialing"===i.status;return c?{icon:"checkmark-circled",label:"Trial period"}:{icon:"checkmark-circled",label:"Enabled"}},S=t=>"$".concat(Number.parseFloat(t).toFixed(2)),E=t=>{let{strategy:e,price:n,tiers:a}=t;const{perUnit:i=!1}=Array.isArray(a)&&a.find(t=>t.price===n)||{},r=["Apps_Marketplace_pricingPlan",e,i&&"perUser"].filter(Boolean).join("_");return p(r,{price:S(n)})}}

