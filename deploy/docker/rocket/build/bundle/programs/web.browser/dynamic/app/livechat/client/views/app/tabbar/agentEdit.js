function module(t,e,a){let n,r,s,i,l,c,m,d,g;a.link("meteor/meteor",{Meteor(t){n=t}},0),a.link("meteor/reactive-var",{ReactiveVar(t){r=t}},1),a.link("meteor/templating",{Template(t){s=t}},2),a.link("toastr",{default(t){i=t}},3),a.link("../customTemplates/register",{getCustomFormTemplate(t){l=t}},4),a.link("./agentEdit.html"),a.link("../../../../../authorization",{hasPermission(t){c=t}},5),a.link("../../../../../utils/client",{t(t){m=t},handleError(t){d=t},APIClient(t){g=t}},6),s.agentEdit.helpers({canEditDepartment:()=>c("add-livechat-department-agents"),agent:()=>s.instance().agent.get(),availableDepartments:()=>s.instance().availableDepartments.get(),hasAvailableDepartments(){if(!c("add-livechat-department-agents"))return;const t=[...s.instance().availableDepartments.get()];return t.length>0},agentDepartments(){const t=s.instance().agentDepartments.get(),e=s.instance().departments.get();return e.filter(e=>{let{_id:a}=e;return t.includes(a)})},hasAgentDepartments(){const t=[...s.instance().agentDepartments.get()];return t.length>0},customFieldsTemplate:()=>l("livechatAgentEditForm"),agentDataContext:()=>s.instance().agent,isReady(){const t=s.instance();return t.ready&&t.ready.get()}}),s.agentEdit.events({"click .cancel"(t){return t.stopPropagation(),t.preventDefault(),this.back&&this.back()},"submit #agent-form"(t,e){t.preventDefault();const a=$(t.currentTarget).data("id"),r={};e.$(".customFormField").each((t,a)=>{const n=e.$(a),s=n.attr("name");r[s]=n.val()});const s=e.agentDepartments.get();n.call("livechat:saveAgentInfo",a,r,s,t=>t?d(t):(i.success(m("Saved")),this.back&&this.back(a)))},"click .remove-department"(t,e){if(t.stopPropagation(),t.preventDefault(),!c("add-livechat-department-agents"))return;const{currentTarget:{dataset:{id:a}}}=t,n=e.agentDepartments.get();e.agentDepartments.set(n.filter(t=>t!==a))},"click #addDepartment"(t,e){if(t.stopPropagation(),t.preventDefault(),$("#departmentSelect").find(":selected").is(":disabled"))return;const a=[...e.agentDepartments.get()],n=$("#departmentSelect").val();""===n||a.indexOf(n)>-1||(a.push(n),e.agentDepartments.set(a),$("#departmentSelect").val("placeholder"))}}),s.agentEdit.onCreated((async function(){this.agent=new r,this.ready=new r(!1),this.agentDepartments=new r([]),this.departments=new r([]),this.availableDepartments=new r([]),this.back=s.currentData().back;const{departments:t}=await g.v1.get('livechat/department?sort={"name": 1}');this.departments.set(t),this.availableDepartments.set(t.filter(t=>{let{enabled:e}=t;return e})),this.autorun(async()=>{this.ready.set(!1);const{agentId:t}=s.currentData();if(!t)return;const{user:e}=await g.v1.get("livechat/users/agent/".concat(t)),{departments:a}=await g.v1.get("livechat/agents/".concat(t,"/departments"));this.agent.set(e),this.agentDepartments.set((a||[]).map(t=>t.departmentId)),this.ready.set(!0)})}))}

