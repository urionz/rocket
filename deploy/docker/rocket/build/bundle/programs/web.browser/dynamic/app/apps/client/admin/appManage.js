function module(e,t,a){let s,n,r,i,c,o,p,l,g,u,h,d,m,v,k,P,f,y,A,_,w,S,b;a.link("@babel/runtime/helpers/objectSpread2",{default(e){s=e}},0),a.link("meteor/meteor",{Meteor(e){n=e}},0),a.link("meteor/reactive-dict",{ReactiveDict(e){r=e}},1),a.link("meteor/kadira:flow-router",{FlowRouter(e){i=e}},2),a.link("meteor/templating",{Template(e){c=e}},3),a.link("meteor/rocketchat:tap-i18n",{TAPi18n(e){o=e},TAPi18next(e){p=e}},4),a.link("meteor/tracker",{Tracker(e){l=e}},5),a.link("underscore",{default(e){g=e}},6),a.link("../../../ui-utils/client",{SideNav(e){u=e}},7),a.link("../../../utils",{isEmail(e){h=e}},8),a.link("../../lib/misc/Utilities",{Utilities(e){d=e}},9),a.link("../communication",{AppEvents(e){m=e}},10),a.link("../orchestrator",{Apps(e){v=e}},11),a.link("./helpers",{appButtonProps(e){k=e},appStatusSpanProps(e){P=e},formatPrice(e){f=e},formatPricingPlan(e){y=e},handleAPIError(e){A=e},triggerAppPopoverMenu(e){_=e},promptSubscription(e){w=e},warnStatusChange(e){S=e},checkCloudLogin(e){b=e}},12),a.link("./appManage.html"),a.link("./appManage.css");const L=async(e,t)=>{try{const a=await v.getAppApis(e);t.set("apis",a)}catch(a){A(a)}},C=async(e,t)=>{try{const a=await v.getAppSettings(e);for(const e of Object.values(a))e.i18nPlaceholder=e.i18nPlaceholder||" ",e.value=void 0!==e.value&&null!==e.value?e.value:e.packageValue,e.oldValue=e.value,e.hasChanged=!1;t.set("settings",a)}catch(a){A(a)}},I=(e,t)=>{e&&e.length&&e.forEach(async(a,s)=>{try{const e=await v.getAppsOnBundle(a.bundleId);a.apps=e.slice(0,4)}catch(n){A(n)}e[s]=a,t.set("bundledIn",e)})},T=async(e,t,a)=>{try{const{categories:s,isPurchased:n,price:r,bundledIn:i,purchaseType:c,subscriptionInfo:o,version:p}=await v.getLatestAppFromMarketplace(e,t);a.set({categories:s,isPurchased:n,price:r,bundledIn:i,purchaseType:c,subscriptionInfo:o,marketplaceVersion:p}),I(i,a)}catch(s){if(s.xhr&&404===s.xhr.status)return;A(s)}},D=async e=>{let{appId:t,version:a,state:n,_app:r}=e,c;try{c=await v.getApp(t)}catch(o){console.error(o)}if(n.set("settings",{}),c)return n.set("isLoading",!1),r.clear(),r.set(s({},c,{installed:!0})),L(t,n),C(t,n),T(t,a,r),"marketplace-app"===i.current().route.getRouteName()?void i.withReplaceState(()=>{i.go("app-manage",{appId:t})}):void 0;try{c=await v.getAppFromMarketplace(t,a)}catch(o){n.set("error",o)}c&&(delete c.status,c.marketplaceVersion=c.version,n.set("isLoading",!1),r.clear(),r.set(s({},c,{installed:!1})),I(c.bundledIn,r),"app-manage"===i.current().route.getRouteName()&&i.withReplaceState(()=>{i.go("marketplace-app",{appId:t})}))};c.appManage.onCreated((function(){var e=this;this.appId=i.getParam("appId"),this.version=i.getQueryParam("version"),this.state=new r({settings:{},isLoading:!0,isSaving:!1}),this._app=new r({id:this.appId,version:this.version}),D(this),this.__=(e,t,a)=>{const s=d.getI18nKeyForApp(e,this.appId);return p.exists("project:".concat(s))?o.__(s,t,a):o.__(e,t,a)};const t=t=>(function(a){const s=a.appId||a;if(s===e.appId){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.call(e,a,...r)}});this.handleSettingUpdated=t(()=>{C(this.appId,this.state)}),this.handleChange=t(()=>{D(this)}),this.handleRemoved=t(()=>i.go("/admin/apps")),v.getWsListener().registerListener(m.APP_ADDED,this.handleChange),v.getWsListener().registerListener(m.APP_UPDATED,this.handleChange),v.getWsListener().registerListener(m.APP_REMOVED,this.handleRemoved),v.getWsListener().registerListener(m.APP_STATUS_CHANGE,this.handleChange),v.getWsListener().registerListener(m.APP_SETTING_UPDATED,this.handleSettingUpdated)})),c.apps.onDestroyed((function(){v.getWsListener().unregisterListener(m.APP_ADDED,this.handleChange),v.getWsListener().unregisterListener(m.APP_UPDATED,this.handleChange),v.getWsListener().unregisterListener(m.APP_REMOVED,this.handleRemoved),v.getWsListener().unregisterListener(m.APP_STATUS_CHANGE,this.handleChange),v.getWsListener().unregisterListener(m.APP_SETTING_UPDATED,this.handleSettingUpdated)})),c.appManage.onRendered(()=>{l.afterFlush(()=>{u.setFlex("adminFlex"),u.openFlex()})}),c.appManage.helpers({isSettingsPristine(){const e=c.instance().state.get("settings");return!Object.values(e).some(e=>{let{hasChanged:t}=e;return t})},isSaving:()=>c.instance().state.get("isSaving"),error(){const e=c.instance().state.get("error");return e&&(e.xhr&&e.xhr.responseJSON&&e.xhr.responseJSON.error||e.message)},isLoading:()=>c.instance().state.get("isLoading"),appButtonProps:k,appStatusSpanProps:P,priceDisplay(){const[e,t,a]=[c.instance()._app.get("purchaseType"),c.instance()._app.get("price"),c.instance()._app.get("pricingPlans")];if("subscription"===e){if(!a||!Array.isArray(a)||0===a.length)return;return y(a[0])}return t>0?f(t):"Free"},isEmail:h,_(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];const[r,i]=[a.slice(-2),a.slice(-1)[0]];return c.instance().__(e,s({},i.hash,{sprintf:r}))},languages:()=>[{key:"",name:"Default",en:"Default"},...Object.entries(o.getLanguages()).map(e=>{let[t,a]=e;return s({key:t},a)}).sort((e,t)=>{let{key:a}=e,{key:s}=t;return a.localeCompare(s)})],selectedOption(e,t){const a=c.instance().state.get("settings");return a[e].value===t},app:()=>c.instance()._app.all(),errors(){const{errors:e={}}=c.instance()._app.get("licenseValidation")||{};return Object.values(e)},warnings(){const{warnings:e={}}=c.instance()._app.get("licenseValidation")||{};return Object.values(e)},settings:()=>Object.values(c.instance().state.get("settings")),apis:()=>c.instance().state.get("apis"),curl(e,t){const a=t.examples[e]||{};return d.curl({url:n.absoluteUrl.defaultOptions.rootUrl+t.computedPath,method:e,params:a.params,query:a.query,content:a.content,headers:a.headers}).split("\n")},renderMethods:e=>e.join("|").toUpperCase(),bundleAppNames:e=>e.map(e=>e.latest.name).join(", ")}),c.appManage.events({"click .js-cancel-editing-settings"(e,t){const a=t.state.get("settings");for(const s of Object.values(a))s.value=s.oldValue,s.hasChanged=!1;t.state.set("settings",a)},async"click .js-save-settings"(e,t){e.preventDefault(),e.stopPropagation();const{appId:a,state:s}=t;if(s.get("isSaving"))return;s.set("isSaving",!0);const n=s.get("settings");try{const e=Object.values(n).filter(e=>{let{hasChanged:t}=e;return t});if(!e.length)return;const t=await v.setAppSettings(a,e);t.forEach(e=>{let{id:t,value:a}=e;n[t].value=a,n[t].oldValue=a,n[t].hasChanged=!1}),s.set("settings",n)}catch(r){A(r)}finally{s.set("isSaving",!1)}},"click .js-close"(){"marketplace-app"!==i.current().route.getRouteName()?"app-manage"!==i.current().route.getRouteName()?window.history.back():i.go("apps"):i.go("marketplace")},"click .js-menu"(e,t){e.stopPropagation();const{currentTarget:a}=e;_(t._app.all(),a,t)},async"click .js-install, click .js-update"(e,t){if(e.stopPropagation(),!(await b()))return;const{appId:a,_app:s}=t;s.set("working",!0);try{const{status:e}=await v.updateApp(a,s.get("marketplaceVersion"));S(s.get("name"),e)}catch(n){A(n)}finally{s.set("working",!1)}},async"click .js-purchase"(e,t){const{_app:a}=t;if(!(await b()))return;a.set("working",!0);const s=a.all();await w(s,async()=>{try{const{status:e}=await v.installApp(s.id,s.marketplaceVersion);S(s.name,e)}catch(e){A(e)}finally{a.set("working",!1)}},()=>a.set("working",!1))},'change input[type="checkbox"]'(e,t){const{id:a}=this,{state:s}=t,n=s.get("settings"),r=n[a];if(!r)return;const i=e.currentTarget.checked;r.value=i,r.hasChanged=r.oldValue!==r.value,s.set("settings",n)},"change .rc-select__element"(e,t){const{id:a}=this,{state:s}=t,n=s.get("settings"),r=n[a];if(!r)return;const{value:i}=e.currentTarget;r.value=i,r.hasChanged=r.oldValue!==r.value,s.set("settings",n)},'input input, input textarea, change input[type="color"]':g.throttle((function(e,t){const{type:a,id:s}=this,{state:n}=t,r=n.get("settings"),i=r[s];if(!i)return;let c=e.currentTarget.value.trim();switch(a){case"int":c=parseInt(c);break;case"boolean":c="1"===c;break;case"code":c=$('.code-mirror-box[data-editor-id="'.concat(s,'"] .CodeMirror'))[0].CodeMirror.getValue()}i.value=c,i.hasChanged=i.oldValue!==i.value,n.set("settings",r)}),500)})}

