function module(t,e,a){"use strict";var r=t("../core/core.defaults"),o=t("../elements/index"),n=t("../helpers/index");r._set("doughnut",{animation:{animateRotate:!0,animateScale:!1},hover:{mode:"single"},legendCallback:function(t){var e=[];e.push('<ul class="'+t.id+'-legend">');var a=t.data,r=a.datasets,o=a.labels;if(r.length)for(var n=0;n<r[0].data.length;++n)e.push('<li><span style="background-color:'+r[0].backgroundColor[n]+'"></span>'),o[n]&&e.push(o[n]),e.push("</li>");return e.push("</ul>"),e.join("")},legend:{labels:{generateLabels:function(t){var e=t.data;return e.labels.length&&e.datasets.length?e.labels.map((function(a,r){var o=t.getDatasetMeta(0),d=e.datasets[0],i=o.data[r],l=i&&i.custom||{},s=n.valueAtIndexOrDefault,h=t.options.elements.arc,u,c,g;return{text:a,fillStyle:l.backgroundColor?l.backgroundColor:s(d.backgroundColor,r,h.backgroundColor),strokeStyle:l.borderColor?l.borderColor:s(d.borderColor,r,h.borderColor),lineWidth:l.borderWidth?l.borderWidth:s(d.borderWidth,r,h.borderWidth),hidden:isNaN(d.data[r])||o.data[r].hidden,index:r}})):[]}},onClick:function(t,e){var a=e.index,r=this.chart,o,n,d;for(o=0,n=(r.data.datasets||[]).length;o<n;++o)(d=r.getDatasetMeta(o)).data[a]&&(d.data[a].hidden=!d.data[a].hidden);r.update()}},cutoutPercentage:50,rotation:-.5*Math.PI,circumference:2*Math.PI,tooltips:{callbacks:{title:function(){return""},label:function(t,e){var a=e.labels[t.index],r=": "+e.datasets[t.datasetIndex].data[t.index];return n.isArray(a)?(a=a.slice())[0]+=r:a+=r,a}}}}),r._set("pie",n.clone(r.doughnut)),r._set("pie",{cutoutPercentage:0}),a.exports=function(t){t.controllers.doughnut=t.controllers.pie=t.DatasetController.extend({dataElementType:o.Arc,linkScales:n.noop,getRingIndex:function(t){for(var e=0,a=0;a<t;++a)this.chart.isDatasetVisible(a)&&++e;return e},update:function(t){var e=this,a=e.chart,r=a.chartArea,o=a.options,d=o.elements.arc,i=r.right-r.left-d.borderWidth,l=r.bottom-r.top-d.borderWidth,s=Math.min(i,l),h={x:0,y:0},u=e.getMeta(),c=o.cutoutPercentage,g=o.circumference;if(g<2*Math.PI){var b=o.rotation%(2*Math.PI),x=(b+=2*Math.PI*(b>=Math.PI?-1:b<-Math.PI?1:0))+g,M={x:Math.cos(b),y:Math.sin(b)},f={x:Math.cos(x),y:Math.sin(x)},m=b<=0&&x>=0||b<=2*Math.PI&&2*Math.PI<=x,I=b<=.5*Math.PI&&.5*Math.PI<=x||b<=2.5*Math.PI&&2.5*Math.PI<=x,p=b<=-Math.PI&&-Math.PI<=x||b<=Math.PI&&Math.PI<=x,P=b<=.5*-Math.PI&&.5*-Math.PI<=x||b<=1.5*Math.PI&&1.5*Math.PI<=x,y=c/100,C={x:p?-1:Math.min(M.x*(M.x<0?1:y),f.x*(f.x<0?1:y)),y:P?-1:Math.min(M.y*(M.y<0?1:y),f.y*(f.y<0?1:y))},v={x:m?1:Math.max(M.x*(M.x>0?1:y),f.x*(f.x>0?1:y)),y:I?1:Math.max(M.y*(M.y>0?1:y),f.y*(f.y>0?1:y))},R={width:.5*(v.x-C.x),height:.5*(v.y-C.y)};s=Math.min(i/R.width,l/R.height),h={x:-.5*(v.x+C.x),y:-.5*(v.y+C.y)}}a.borderWidth=e.getMaxBorderWidth(u.data),a.outerRadius=Math.max((s-a.borderWidth)/2,0),a.innerRadius=Math.max(c?a.outerRadius/100*c:0,0),a.radiusLength=(a.outerRadius-a.innerRadius)/a.getVisibleDatasetCount(),a.offsetX=h.x*a.outerRadius,a.offsetY=h.y*a.outerRadius,u.total=e.calculateTotal(),e.outerRadius=a.outerRadius-a.radiusLength*e.getRingIndex(e.index),e.innerRadius=Math.max(e.outerRadius-a.radiusLength,0),n.each(u.data,(function(a,r){e.updateElement(a,r,t)}))},updateElement:function(t,e,a){var r=this,o=r.chart,d=o.chartArea,i=o.options,l=i.animation,s=(d.left+d.right)/2,h=(d.top+d.bottom)/2,u=i.rotation,c=i.rotation,g=r.getDataset(),b=a&&l.animateRotate?0:t.hidden?0:r.calculateCircumference(g.data[e])*(i.circumference/(2*Math.PI)),x=a&&l.animateScale?0:r.innerRadius,M=a&&l.animateScale?0:r.outerRadius,f=n.valueAtIndexOrDefault;n.extend(t,{_datasetIndex:r.index,_index:e,_model:{x:s+o.offsetX,y:h+o.offsetY,startAngle:u,endAngle:c,circumference:b,outerRadius:M,innerRadius:x,label:f(g.label,e,o.data.labels[e])}});var m=t._model,I=t.custom||{},p=n.valueAtIndexOrDefault,P=this.chart.options.elements.arc;m.backgroundColor=I.backgroundColor?I.backgroundColor:p(g.backgroundColor,e,P.backgroundColor),m.borderColor=I.borderColor?I.borderColor:p(g.borderColor,e,P.borderColor),m.borderWidth=I.borderWidth?I.borderWidth:p(g.borderWidth,e,P.borderWidth),a&&l.animateRotate||(m.startAngle=0===e?i.rotation:r.getMeta().data[e-1]._model.endAngle,m.endAngle=m.startAngle+m.circumference),t.pivot()},calculateTotal:function(){var t=this.getDataset(),e=this.getMeta(),a=0,r;return n.each(e.data,(function(e,o){r=t.data[o],isNaN(r)||e.hidden||(a+=Math.abs(r))})),a},calculateCircumference:function(t){var e=this.getMeta().total;return e>0&&!isNaN(t)?2*Math.PI*(Math.abs(t)/e):0},getMaxBorderWidth:function(t){for(var e=0,a=this.index,r=t.length,o,n,d=0;d<r;d++)o=t[d]._model?t[d]._model.borderWidth:0,e=(n=t[d]._chart?t[d]._chart.config.data.datasets[a].hoverBorderWidth:0)>(e=o>e?o:e)?n:e;return e}})}}

