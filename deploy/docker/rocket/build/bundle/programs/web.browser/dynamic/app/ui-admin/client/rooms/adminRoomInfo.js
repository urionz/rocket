function module(e,t,o){let n,a,r,i,c,s,m,l,u,d,h,_,p,g,v,f;o.link("meteor/meteor",{Meteor(e){n=e}},0),o.link("meteor/reactive-var",{ReactiveVar(e){a=e}},1),o.link("meteor/session",{Session(e){r=e}},2),o.link("meteor/templating",{Template(e){i=e}},3),o.link("meteor/rocketchat:tap-i18n",{TAPi18n(e){c=e}},4),o.link("toastr",{default(e){s=e}},5),o.link("underscore.string",{default(e){m=e}},6),o.link("../../../utils",{t(e){l=e},handleError(e){u=e}},7),o.link("../../../ui-utils",{call(e){d=e},modal(e){h=e}},8),o.link("../../../authorization",{hasAllPermission(e){_=e},hasAtLeastOnePermission(e){p=e}},9),o.link("../../../channel-settings",{ChannelSettings(e){g=e}},10),o.link("../../../settings",{settings(e){v=e}},11),o.link("../../../callbacks",{callbacks(e){f=e}},12),i.adminRoomInfo.helpers({selectedRoom:()=>r.get("adminRoomsSelected"),canEdit(){return _("edit-room",this.rid)},editing:e=>i.instance().editing.get()===e,notDirect(){const e=i.instance().room.get();return e&&"d"!==e.t},roomType(){const e=i.instance().room.get();return e&&e.t},channelSettings:()=>g.getOptions(void 0,"admin-room"),roomTypeDescription(){const e=i.instance().room.get(),t=e&&e.t;return"c"===t?l("Channel"):"p"===t?l("Private_Group"):void 0},roomName(){const e=i.instance().room.get();return e&&e.name},roomOwner(){const e=i.instance().roomOwner.get();return e&&(e.name||e.username)},roomTopic(){const e=i.instance().room.get();return e&&e.topic},archivationState(){const e=i.instance().room.get();return e&&e.archived},archivationStateDescription(){const e=i.instance().room.get(),t=e&&e.archived;return l(!0===t?"Room_archivation_state_true":"Room_archivation_state_false")},canDeleteRoom(){const e=i.instance().room.get(),t=e&&e.t;return null!=t&&p("delete-".concat(t))},readOnly(){const e=i.instance().room.get();return e&&e.ro},readOnlyDescription(){const e=i.instance().room.get(),t=e&&e.ro;return l(!0===t?"True":"False")}}),i.adminRoomInfo.events({"click .delete"(e,t){h.open({title:l("Are_you_sure"),text:l("Delete_Room_Warning"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:l("Yes_delete_it"),cancelButtonText:l("Cancel"),closeOnConfirm:!1,html:!1},()=>{n.call("eraseRoom",this.rid,(function(e){e?u(e):(h.open({title:l("Deleted"),text:l("Room_has_been_deleted"),type:"success",timer:2e3,showConfirmButton:!1}),t.onSuccess(),t.data.tabBar.close())}))})},"keydown input[type=text]"(e,t){13===e.keyCode&&(e.preventDefault(),t.saveSetting(this.rid))},"click [data-edit]":(e,t)=>(e.preventDefault(),t.editing.set($(e.currentTarget).data("edit")),setTimeout((function(){t.$("input.editing").focus().select()}),100)),"click .cancel"(e,t){e.preventDefault(),t.editing.set()},"click .save"(e,t){e.preventDefault(),t.saveSetting(this.rid)}}),i.adminRoomInfo.onCreated((function(){const e=this,t=i.currentData();this.editing=new a,this.room=new a,this.roomOwner=new a,this.onSuccess=i.currentData().onSuccess,this.autorun(()=>{const{room:e}=i.currentData();this.room.set(e)}),this.validateRoomType=()=>{const e=this.$("input[name=roomType]:checked").val();return"c"!==e&&"p"!==e&&s.error(l("error-invalid-room-type",{type:e})),!0},this.validateRoomName=e=>{const{room:o}=t;let n;if(!_("edit-room",e)||"c"!==o.t&&"p"!==o.t)return s.error(l("error-not-allowed")),!1;name=$("input[name=roomName]").val();try{n=new RegExp("^".concat(v.get("UTF8_Names_Validation"),"$"))}catch(a){n=new RegExp("^[0-9a-zA-Z-_.]+$")}return!!n.test(name)||(s.error(l("error-invalid-room-name",{room_name:m.escapeHTML(name)})),!1)},this.validateRoomTopic=()=>!0,this.saveSetting=o=>{switch(this.editing.get()){case"roomName":this.validateRoomName(o)&&(f.run("roomNameChanged",t.room),n.call("saveRoomSettings",o,"roomName",this.$("input[name=roomName]").val(),(function(t){if(t)return u(t);s.success(c.__("Room_name_changed_successfully")),e.onSuccess(),e.data.tabBar.close()})));break;case"roomTopic":this.validateRoomTopic(o)&&n.call("saveRoomSettings",o,"roomTopic",this.$("input[name=roomTopic]").val(),(function(o){if(o)return u(o);s.success(c.__("Room_topic_changed_successfully")),f.run("roomTopicChanged",t.room),e.onSuccess(),e.data.tabBar.close()}));break;case"roomAnnouncement":this.validateRoomTopic(o)&&n.call("saveRoomSettings",o,"roomAnnouncement",this.$("input[name=roomAnnouncement]").val(),(function(o){if(o)return u(o);s.success(c.__("Room_announcement_changed_successfully")),f.run("roomAnnouncementChanged",t.room),e.onSuccess(),e.data.tabBar.close()}));break;case"roomType":const a=this.$("input[name=roomType]:checked").val();if(this.validateRoomType(o)){f.run("roomTypeChanged",t.room);const r=function(){n.call("saveRoomSettings",o,"roomType",a,(function(t){if(t)return u(t);s.success(c.__("Room_type_changed_successfully")),e.onSuccess(),e.data.tabBar.close()}))};if(!t.room.default)return r();h.open({title:l("Room_default_change_to_private_will_be_default_no_more"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:l("Yes"),cancelButtonText:l("Cancel"),closeOnConfirm:!0,html:!1},(function(e){return!e||r()}))}break;case"archivationState":const{room:r}=t;"true"===this.$("input[name=archivationState]:checked").val()?r&&!0!==r.archived&&n.call("archiveRoom",o,(function(o){if(o)return u(o);s.success(c.__("Room_archived")),f.run("archiveRoom",t.room),e.onSuccess(),e.data.tabBar.close()})):!0===(r&&r.archived)&&n.call("unarchiveRoom",o,(function(o){if(o)return u(o);s.success(c.__("Room_unarchived")),f.run("unarchiveRoom",t.room),e.onSuccess(),e.data.tabBar.close()}));break;case"readOnly":n.call("saveRoomSettings",o,"readOnly","true"===this.$("input[name=readOnly]:checked").val(),(function(t){if(t)return u(t);s.success(c.__("Read_only_changed_successfully")),e.onSuccess(),e.data.tabBar.close()}))}this.editing.set()},this.autorun(async()=>{this.roomOwner.set(null);for(const{roles:e,u:t}of await d("getRoomRoles",r.get("adminRoomsSelected").rid))e.includes("owner")&&this.roomOwner.set(t)})}))}

