function module(e,t,n){let s,i,a,c,l,o,g;n.link("meteor/meteor",{Meteor(e){s=e}},0),n.link("meteor/reactive-var",{ReactiveVar(e){i=e}},1),n.link("meteor/templating",{Template(e){a=e}},2),n.link("../../../../settings",{settings(e){c=e}},3),n.link("../../../../authorization",{hasPermission(e){l=e}},4),n.link("../../../../models",{Users(e){o=e}},5),n.link("./livechatQueue.html"),n.link("../../../../utils/client",{APIClient(e){g=e}},6);const u=50;a.livechatQueue.helpers({departments:()=>a.instance().departments.get().filter(e=>!0===e.enabled),onSelectAgents:()=>a.instance().onSelectAgents,agentModifier:()=>(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.get();return"@".concat(0===n.length?t:t.replace(new RegExp(e.get()),e=>"<strong>".concat(e,"</strong>")))}),selectedAgents:()=>a.instance().selectedAgents.get(),onClickTagAgent:()=>a.instance().onClickTagAgent,queue:()=>a.instance().queue.get(),isLoading:()=>a.instance().isLoading.get(),hasPermission(){const e=o.findOne(s.userId(),{fields:{statusLivechat:1}});return l(s.userId(),"view-livechat-queue")||"available"===e.statusLivechat&&c.get("Livechat_show_queue_list_link")},hasMore(){const e=a.instance(),t=e.queue.get();return e.total.get()>t.length}}),a.livechatQueue.events({"click .show-offline"(e,t){const n=t.showOffline.get();n[this._id]=e.currentTarget.checked,t.showOffline.set(n)},"submit form"(e,t){e.preventDefault(),t.queue.set([]),t.offset.set(0);const n={};$(":input",e.currentTarget).each((function(){if(!this.name)return;const e=$(this).val();n[this.name]=e}));const s=t.selectedAgents.get();s&&s.length>0&&(n.agent=s[0]._id),t.filter.set(n)},"click .js-load-more"(e,t){t.offset.set(t.offset.get()+50)}}),a.livechatQueue.onCreated((async function(){this.selectedAgents=new i([]),this.departments=new i([]),this.limit=new i(20),this.filter=new i({}),this.queue=new i([]),this.isLoading=new i(!0),this.offset=new i(0),this.total=new i(0),this.onSelectAgents=e=>{let{item:t}=e;this.selectedAgents.set([t])},this.onClickTagAgent=e=>{let{username:t}=e;this.selectedAgents.set(this.selectedAgents.get().filter(e=>e.username!==t))},this.autorun(async()=>{this.isLoading.set(!0);const e=this.filter.get(),t=this.offset.get();let n="includeOfflineAgents=".concat("offline"===e.agentStatus);e.agent&&(n+="&agentId=".concat(e.agent)),e.department&&(n+="&departmentId=".concat(e.department));const{queue:s,total:i}=await g.v1.get("livechat/queue?".concat(n,"&count=").concat(50,"&offset=").concat(t));this.total.set(i),this.queue.set(this.queue.get().concat(s)),this.isLoading.set(!1)});const{departments:e}=await g.v1.get('livechat/department?sort={"name": 1}');this.departments.set(e)}))}

