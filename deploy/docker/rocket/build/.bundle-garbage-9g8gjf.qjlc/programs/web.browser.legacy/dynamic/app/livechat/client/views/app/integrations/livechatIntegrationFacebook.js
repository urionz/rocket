function module(e,t,n){var i,a,o,c,s,l;n.link("meteor/meteor",{Meteor:function(e){i=e}},0),n.link("meteor/reactive-var",{ReactiveVar:function(e){a=e}},1),n.link("meteor/templating",{Template:function(e){o=e}},2),n.link("../../../../../ui-utils",{modal:function(e){c=e}},3),n.link("../../../../../utils",{t:function(e){s=e},handleError:function(e){l=e}},4),n.link("./livechatIntegrationFacebook.html"),o.livechatIntegrationFacebook.helpers({pages:function(){return o.instance().pages.get()},subscribed:function(){return this.subscribed?"checked":""},enabled:function(){return o.instance().enabled.get()},hasToken:function(){return o.instance().hasToken.get()},enableButtonDisabled:function(){return o.instance().hasToken.get()?"":"disabled"},isLoading:function(){return o.instance().loading.get()}}),o.livechatIntegrationFacebook.onCreated((function(){var e=this;this.enabled=new a(!1),this.hasToken=new a(!1),this.pages=new a([]),this.loading=new a(!1),this.autorun((function(){e.enabled.get()&&e.loadPages()})),this.result=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(a,o){if(a&&a.error)switch(a.error){case"invalid-facebook-token":case"invalid-instance-url":case"integration-disabled":return i.call("livechat:facebook",{action:"enable"},e.result((function(){e.enabled.set(!0),e.loadPages()}),(function(){return e.loadPages()})))}if(!o||!1!==o.success||"OAuthException"!==o.type&&void 0===o.url){if(a)return n(a),c.open({title:s("Error_loading_pages"),text:a.reason,type:"error"});t(o)}else var l=window.open(o.url,"facebook-integration-oauth","width=600,height=400"),r=setInterval((function(){l.closed&&(clearInterval(r),n(a))}),300)}},this.loadPages=function(){e.pages.set([]),e.loading.set(!0),i.call("livechat:facebook",{action:"list-pages"},e.result((function(t){e.pages.set(t.pages),e.loading.set(!1)}),(function(){return e.loading.set(!1)})))}})),o.livechatIntegrationFacebook.onRendered((function(){var e=this;this.loading.set(!0),i.call("livechat:facebook",{action:"initialState"},this.result((function(t){e.enabled.set(t.enabled),e.hasToken.set(t.hasToken),e.loading.set(!1)})))})),o.livechatIntegrationFacebook.events({"click .reload":function(e,t){e.preventDefault(),t.loadPages()},"click .enable":function(e,t){e.preventDefault(),i.call("livechat:facebook",{action:"enable"},t.result((function(){t.enabled.set(!0)}),(function(){return t.enabled.set(!0)})))},"click .disable":function(e,t){e.preventDefault(),c.open({title:s("Disable_Facebook_integration"),text:s("Are_you_sure_you_want_to_disable_Facebook_integration"),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:s("Yes"),cancelButtonText:s("Cancel"),closeOnConfirm:!1,html:!1},(function(){i.call("livechat:facebook",{action:"disable"},(function(e){if(e)return l(e);t.enabled.set(!1),t.pages.set([]),c.open({title:s("Disabled"),text:s("Integration_disabled"),type:"success",timer:2e3,showConfirmButton:!1})}))}))},"change [name=subscribe]":function(e,t){var n=this;i.call("livechat:facebook",{action:e.currentTarget.checked?"subscribe":"unsubscribe",page:this.id},(function(i,a){if(a.success){var o=t.pages.get();o.forEach((function(t){t.id===n.id&&(t.subscribed=e.currentTarget.checked)})),t.pages.set(o)}}))}})}

