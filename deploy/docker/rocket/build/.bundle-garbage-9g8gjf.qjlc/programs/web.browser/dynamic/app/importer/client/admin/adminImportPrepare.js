function module(e,t,r){let n,s,a,i,o,c,p,l,m,d,g,u,h,_,k,I;function f(e){p.get("v1/getImportFileData").then(t=>{if(!t)return console.warn("The importer is not set up correctly, as it did not return any data."),o.error(c("Importer_not_setup")),s.go("/admin/import");if(t.waiting)setTimeout(()=>{f(e)},1e3);else{if(t.step)return console.warn("Invalid file, contains `data.step`.",t),o.error(c("Failed_To_Load_Import_Data")),s.go("/admin/import");e.users.set(t.users),e.channels.set(t.channels),e.message_count.set(t.message_count),e.preparing.set(!1),e.progressRate.set(!1)}}).catch(e=>{if(e)return k(e,"Failed_To_Load_Import_Data"),s.go("/admin/import")})}function R(e){p.get("v1/getCurrentImportOperation").then(t=>{const{operation:r}=t;return r.valid?h.includes(r.status)?s.go("/admin/import/progress"):r.status===m.USER_SELECTION||u.includes(r.status)||g.includes(r.status)?(e.callbackRegistered||(I.registerCallback(e.progressUpdated),e.callbackRegistered=!0),f(e),e.preparing.set(!0)):d.includes(r.status)?(setTimeout(()=>{R(e)},1e3),e.preparing.set(!0)):_.includes(r.status)?(o.error(c("Import_Operation_Failed")),s.go("/admin/import")):r.status===m.DONE?s.go("/admin/import"):(o.error(c("Unknown_Import_State")),s.go("/admin/import")):s.go("/admin/import/new")}).catch(e=>{if(e)return o.error(c("Failed_To_Load_Import_Data")),s.go("/admin/import")})}r.link("meteor/tracker",{Tracker(e){n=e}},0),r.link("meteor/kadira:flow-router",{FlowRouter(e){s=e}},1),r.link("meteor/templating",{Template(e){a=e}},2),r.link("meteor/reactive-var",{ReactiveVar(e){i=e}},3),r.link("toastr",{default(e){o=e}},4),r.link("../../../utils",{t(e){c=e},APIClient(e){p=e}},5),r.link("../../../ui-utils/client",{SideNav(e){l=e}},6),r.link("../../lib/ImporterProgressStep",{ProgressStep(e){m=e},ImportWaitingStates(e){d=e},ImportFileReadyStates(e){g=e},ImportPreparingStartedStates(e){u=e},ImportingStartedStates(e){h=e},ImportingErrorStates(e){_=e}},7),r.link("../functions/showImporterException",{showImporterException(e){k=e}},8),r.link("..",{ImporterWebsocketReceiver(e){I=e}},9),r.link("./adminImportPrepare.html"),a.adminImportPrepare.helpers({isPreparing:()=>a.instance().preparing.get(),hasProgressRate:()=>!1!==a.instance().progressRate.get(),progressRate(){const e=a.instance().progressRate.get();return e?"".concat(e,"%"):""},pageTitle:()=>c("Importing_Data"),users:()=>a.instance().users.get(),channels:()=>a.instance().channels.get(),message_count:()=>a.instance().message_count.get()}),a.adminImportPrepare.events({"click .button.start"(e,t){const r=this;$(r).prop("disabled",!0);for(const n of Array.from(t.users.get()))n.do_import=$("[name='".concat(n.user_id,"']")).is(":checked");for(const n of Array.from(t.channels.get()))n.do_import=$("[name='".concat(n.channel_id,"']")).is(":checked");p.post("v1/startImport",{input:{users:t.users.get(),channels:t.channels.get()}}).then(()=>(t.users.set([]),t.channels.set([]),s.go("/admin/import/progress"))).catch(e=>{if(e)return k(e,"Failed_To_Start_Import"),s.go("/admin/import")})},"click .button.uncheck-deleted-users"(e,t){Array.from(t.users.get()).filter(e=>e.is_deleted).map(e=>{const t=$("[name=".concat(e.user_id,"]"));return t&&t.length&&t[0].checked&&t.click()})},"click .button.uncheck-archived-channels"(e,t){Array.from(t.channels.get()).filter(e=>e.is_archived).map(e=>{const t=$("[name=".concat(e.channel_id,"]"));return t&&t.length&&t[0].checked&&t.click()})}}),a.adminImportPrepare.onCreated((function(){this.preparing=new i(!0),this.progressRate=new i(!1),this.callbackRegistered=!1,this.users=new i([]),this.channels=new i([]),this.message_count=new i(0),this.progressUpdated=e=>{if("rate"in e){const{rate:t}=e;this.progressRate.set(t)}},R(this)})),a.adminImportPrepare.onRendered(()=>{n.afterFlush(()=>{l.setFlex("adminFlex"),l.openFlex()})}),a.adminImportPrepare.onDestroyed((function(){this.callbackRegistered=!1,I.unregisterCallback(this.progressUpdated)}))}

