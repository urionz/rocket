function module(t,i,s){let o,e,r,n,a;s.link("meteor/reactive-var",{ReactiveVar(t){o=t}},0),s.link("meteor/templating",{Template(t){e=t}},1),s.link("moment",{default(t){r=t}},2),s.link("underscore",{default(t){n=t}},3),s.link("./visitorHistory.html"),s.link("../../../../../utils/client",{APIClient(t){a=t}},4);const c=50;e.visitorHistory.helpers({isLoading:()=>e.instance().isLoading.get(),previousChats:()=>e.instance().history.get(),title(){let t=r(this.ts).format("L LTS");return this.label&&(t+=" - ".concat(this.label)),t}}),e.visitorHistory.onCreated((function(){const t=e.currentData();this.visitorId=new o,this.isLoading=new o(!1),this.history=new o([]),this.offset=new o(0),this.total=new o(0),this.autorun(async()=>{const{room:i}=await a.v1.get("rooms.info?roomId=".concat(t.rid));i&&i.v&&this.visitorId.set(i.v._id)}),this.autorun(async()=>{if(!this.visitorId.get()||!t||!t.rid)return;const i=this.offset.get();this.isLoading.set(!0);const{history:s,total:o}=await a.v1.get("livechat/visitors.chatHistory/room/".concat(t.rid,"/visitor/").concat(this.visitorId.get(),"?count=").concat(50,"&offset=").concat(i));this.isLoading.set(!1),this.total.set(o),this.history.set(this.history.get().concat(s))})})),e.visitorHistory.events({"scroll .visitor-scroll":n.throttle((function(t,i){if(t.target.scrollTop>=t.target.scrollHeight-t.target.clientHeight){const t=i.history.get();if(i.total.get()<=t.length)return;return i.offset.set(i.offset.get()+50)}}),200)})}

